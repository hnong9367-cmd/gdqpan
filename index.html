<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.8.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        :root {
            --primary-bg: #f4f6f9;
            --secondary-bg: #ffffff;
            --text-color: #212529;
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8; /* MÃ€U Má»šI */
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: Arial, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            margin: 0;
            padding: 15px;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background-color: var(--secondary-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow-y: auto;
            max-height: 95vh;
        }
        .screen { display: none; }
        .screen.active { display: block; }
        h1, h2, h3 { text-align: center; color: var(--primary-color); }
        textarea, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: var(--border-radius);
            box-sizing: border-box;
            margin-bottom: 15px;
        }
        textarea { height: 250px; overflow-y: auto; }
        .button-group { display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px; }
        .btn {
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background-color: var(--primary-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
            text-decoration: none; /* Cho tháº» <a> */
            display: inline-block; /* Cho tháº» <a> */
        }
        .btn:hover { background-color: #0056b3; }
        .btn-secondary { background-color: var(--secondary-color); }
        .btn-secondary:hover { background-color: #5a6268; }
        .btn-danger { background-color: var(--danger-color); }
        .btn-danger:hover { background-color: #c82333; }
        .btn-warning { background-color: var(--warning-color); }
        .btn-warning:hover { background-color: #e0a800; }
        .btn-success { background-color: var(--success-color); }
        .btn-success:hover { background-color: #218838; }
        .btn-info { background-color: var(--info-color); }
        .btn-info:hover { background-color: #138496; }

        .output-box {
            background-color: #fdfdfd; border-radius: 8px; padding: 15px;
            border: 1px solid #eee; margin-top: 10px; min-height: 300px;
        }
        #visual-review-output { font-size: 16px; white-space: pre-wrap; word-wrap: break-word; line-height: 1.8; }
        .legend {
            border: 1px solid #ccc; padding: 10px; border-radius: 8px;
            margin-top: 20px; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;
        }
        .legend-item { display: flex; align-items: center; font-size: 14px; }
        .legend-color { width: 20px; height: 20px; border: 1px solid #999; margin-right: 8px; }
        .ignored { background-color: #ffcccc; }
        .question { background-color: #ff9933; color: black; padding: 1px 3px; border-radius: 3px;}
        .correct-answer { background-color: #28a745; color: white; padding: 1px 3px; border-radius: 3px;}
        .incorrect-answer { background-color: #ffd700; color: black; padding: 1px 3px; border-radius: 3px;}
        .question-chunk {
            display: block; border: 1px dotted #ccc;
            padding: 10px; margin-bottom: 10px; border-radius: 4px;
        }

        .warning-collapsed {
            padding: 10px 15px;
            background-color: var(--warning-color);
            color: #333;
            border-radius: var(--border-radius);
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            margin-bottom: 20px;
            transition: background-color 0.2s;
        }
        .warning-collapsed:hover {
            background-color: #e0a800;
        }
        .warning-details {
            border: 2px solid var(--danger-color);
            padding: 15px;
            border-radius: 5px;
            background-color: #fff5f5;
            margin-bottom: 20px;
        }
        .question-container { margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .options-container label { display: block; margin-bottom: 10px; padding: 8px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        .options-container label:hover { background-color: #f0f0f0; }
        .question-text { font-size: 18px; margin-bottom: 5px; font-weight: bold; }
        .sidebar { width: 260px; max-height: 80vh; overflow-y: auto; position: fixed; top: 0; left: 0; height: 100%; background-color: var(--secondary-bg); box-shadow: var(--box-shadow); transition: transform 0.3s ease; }
        .pill-container { display: flex; flex-wrap: wrap; gap: 8px; padding: 8px; }
        .main-content { transition: all 0.3s ease; padding: 15px; }
        .with-sidebar { margin-left: 260px; width: calc(100% - 260px); }
        .full { margin-left: 0; width: 100%; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; }
        .modal-content { background-color: var(--secondary-bg); margin: 5% auto; padding: 20px; border-radius: var(--border-radius); width: 95%; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: var(--box-shadow); position: relative; }
        #statisticsModal .modal-content { max-width: 500px; }
        .modal-content.large-search-open { margin-top: 0.5%; padding-top: 150px; }
        .comparison-question { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #ccc; }
        .comparison-question:last-of-type { border-bottom: none; }
        .comparison-question-text { margin-bottom: 15px; white-space: pre-wrap; }
        .options-comparison-wrapper { display: flex; flex-direction: row; gap: 15px; }
        .options-column { flex: 1; min-width: 48%; border: 1px solid #e0e0e0; border-radius: var(--border-radius); padding: 10px; background-color: #fdfdfd; }
        .options-column h5 { margin-top: 0; text-align: center; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px; font-size: 16px; }
        .option-item { padding: 4px; margin: 3px 0; border-radius: 4px; }
        #comparison-menu-btn { position: fixed; top: 20px; right: 20px; width: 40px; height: 40px; background-color: var(--primary-color); border-radius: 50%; cursor: pointer; z-index: 1002; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #comparison-menu-btn .bar { width: 20px; height: 2px; background-color: white; transition: all 0.3s; }
        .search-menu { background-color: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 1001; box-sizing: border-box; position: absolute; }
        .search-menu h4 { margin-top: 0; color: var(--primary-color); }
        .search-menu .input-group { margin-bottom: 15px; display: flex; align-items: center; }
        .search-menu .input-group label { width: 60px; }
        .search-menu input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .search-menu .icon-btn { background: none; border: none; cursor: pointer; font-size: 24px; }
        .search-menu .clear-btn { border: 1px solid #ccc; border-radius: 4px; padding: 2px 8px; cursor: pointer; }
        #small-search-menu { top: 65px; right: 20px; width: 300px; height: auto; padding: 15px; border-radius: var(--border-radius); transform-origin: top right; transition: transform 0.2s ease-out, opacity 0.2s; transform: scale(0.95); opacity: 0; pointer-events: none; }
        #small-search-menu.open { transform: scale(1); opacity: 1; pointer-events: auto; }
        #large-search-menu { top: 0; left: 0; width: 100%; height: auto; display: flex; flex-direction: column; padding: 15px 65px 15px 15px; border-bottom: 1px solid #eee; transition: transform 0.3s ease-in-out; transform: translateY(-110%); }
        #large-search-menu.open { transform: translateY(0); }
        #large-search-menu .search-controls { display: flex; width: 100%; gap: 10px; align-items: center; margin-top: 45px; }
        #large-search-menu .input-group { flex: 1; margin-bottom: 0; }
        #large-search-results { font-weight: bold; color: var(--success-color); margin-top: 10px; }
        .nav-buttons { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        mark { background-color: #ffc107; padding: 0 2px; }
        .fixed-btn { position: fixed; bottom: 30px; right: 30px; padding: 15px 25px; font-size: 18px; font-weight: bold; color: white; background-color: var(--success-color); border: none; border-radius: 50px; cursor: pointer; text-align: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 999; }
        .fixed-btn:hover { background-color: #218838; transform: scale(1.05); }
        #comparison-help-btn { position: fixed; top: 20px; left: 20px; width: 40px; height: 40px; background-color: var(--secondary-color); border-radius: 50%; cursor: pointer; z-index: 1002; display: flex; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #helpModal .modal-content ul { list-style-type: none; padding: 0; }
        #helpModal .modal-content li { margin-bottom: 15px; line-height: 1.6; }
        #helpModal .modal-content .icon { display: inline-block; width: 20px; text-align: center; margin-right: 10px; }
        #statistics-legend { margin-top: 15px; font-size: 16px; line-height: 1.6; text-align: center; border-top: 1px solid #eee; padding-top: 15px; }
        #statistics-chart { min-height: 300px; color: #333; }
        .user-greeting { text-align: center; margin-bottom: 20px; font-size: 1.1em; color: var(--secondary-color); }
        #sync-status {
            text-align: center; padding: 8px; font-size: 14px; color: white;
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            border-radius: 8px 8px 0 0; z-index: 2000; display: none;
            transition: opacity 0.5s;
        }
        #sync-status.syncing { background-color: var(--info-color); }
        #sync-status.success { background-color: var(--success-color); }
        #sync-status.error { background-color: var(--danger-color); }
    </style>

    <!-- ================================================================== -->
    <!-- =================== KHAI BÃO FIREBASE SDK ======================== -->
    <!-- ================================================================== -->
    <script type="module">
        // Import cÃ¡c hÃ m cáº§n thiáº¿t tá»« Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, ref, get, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        // Cáº¥u hÃ¬nh Firebase Gá»C cá»§a báº¡n
        const firebaseConfig = {
            apiKey: "AIzaSyAnt9ctszFdlVIwdX9KDS4hpvyfglclJQ0",
            authDomain: "quizzz-de3f6.firebaseapp.com",
            projectId: "quizzz-de3f6",
            storageBucket: "quizzz-de3f6.appspot.com",
            messagingSenderId: "775849270363",
            appId: "1:775849270363:web:f2871cab3227d93f88737e",
            databaseURL: "https://quizzz-de3f6-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        // Khá»Ÿi táº¡o Firebase vÃ  export Ä‘á»ƒ script chÃ­nh cÃ³ thá»ƒ dÃ¹ng
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ÄÆ°a cÃ¡c hÃ m cáº§n thiáº¿t vÃ o scope global Ä‘á»ƒ script bÃªn dÆ°á»›i cÃ³ thá»ƒ truy cáº­p
        window.firebaseSDK = {
            ref,
            get,
            set,
            serverTimestamp,
            db
        };
    </script>
    <!-- ================================================================== -->

</head>
<body class="bg-gray-100">
    <div id="sync-status"></div>
    <div id="loading-screen" class="modal" style="display: none; justify-content: center; align-items: center; background-color: rgba(0, 0, 0, 0.3);">
        <div style="background: white; padding: 25px 50px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
            <h3 style="margin-top: 0;">Äang xá»­ lÃ½...</h3>
            <p>Vui lÃ²ng Ä‘á»£i trong giÃ¢y lÃ¡t.</p>
        </div>
    </div>
    <div class="container">
        <div id="login-screen" class="screen">
            <h1>ChÃ o má»«ng!</h1>
            <p style="text-align: center; margin-bottom: 20px;">Vui lÃ²ng nháº­p tÃªn cá»§a báº¡n Ä‘á»ƒ báº¯t Ä‘áº§u.</p>
            <input type="text" id="username-input" placeholder="Nháº­p tÃªn cá»§a báº¡n...">
            <div class="button-group">
                <button id="login-btn" class="btn">VÃ o Menu ChÃ­nh</button>
            </div>
        </div>

        <!-- MÃ€N HÃŒNH CHÃNH (ÄÃƒ ÄÆ¯á»¢C NÃ‚NG Cáº¤P) -->
        <div id="home-screen" class="screen">
            <h1>Quiz Player</h1>
            <p id="user-greeting" class="user-greeting"></p>
            <div class="button-group">
                <button class="btn btn-success" onclick="showScreen('pre-quiz-menu-screen')">Báº¯t Ä‘áº§u lÃ m bÃ i</button>
                <a href="./bangxephang.html" target="_blank" class="btn btn-info">Xem Báº£ng Xáº¿p Háº¡ng</a>
                <button class="btn btn-secondary" onclick="showScreen('history-list-screen')">Xem Lá»‹ch Sá»­ LÃ m BÃ i</button>
            </div>
        </div>

        <!-- MÃ€N HÃŒNH MENU LÃ€M BÃ€I -->
        <div id="pre-quiz-menu-screen" class="screen">
            <h2>TÃ¹y chá»n lÃ m bÃ i</h2>
            <div class="button-group">
                <button id="menu-shuffle-btn" class="btn">Trá»™n cÃ¢u há»i vÃ  Ä‘Ã¡p Ã¡n: Táº¯t</button>
                <button id="menu-start-btn" class="btn btn-success">Báº¯t Äáº§u</button>
                <button id="menu-back-btn" class="btn btn-secondary" onclick="showScreen('home-screen')">Quay Láº¡i</button>
            </div>
        </div>

        <div id="history-list-screen" class="screen">
            <div id="history-sidebar" class="sidebar">
                <div class="p-4 font-bold">ğŸ“œ Lá»‹ch Sá»­ LÃ m BÃ i</div>
                <div id="history-list" class="pill-container"></div>
                <button class="btn btn-secondary m-2" onclick="showScreen('home-screen')">Vá» Trang Chá»§</button>
            </div>
            <div id="history-mainContent" class="main-content with-sidebar">
                <h1 class="text-2xl font-bold mb-4">Danh sÃ¡ch lá»‹ch sá»­ lÃ m bÃ i</h1>
                <p class="text-gray-600">ğŸ‘‰ Vuá»‘t sang trÃ¡i Ä‘á»ƒ áº©n sidebar, vuá»‘t sang pháº£i Ä‘á»ƒ má»Ÿ láº¡i.</p>
                <div id="history-questionBox" class="mt-6 p-4 bg-white rounded-xl shadow max-w-md hidden text-left space-y-4"></div>
            </div>
            <div id="history-contentModal" class="modal">
                <div id="history-contentModalContent" class="modal-content">
                    <h3 id="history-modalTitle"></h3>
                    <div id="history-modalContent"></div>
                    <div class="button-group mt-4">
                        <button class="btn btn-secondary" onclick="closeHistoryModal()">Quay láº¡i</button>
                        <button class="btn btn-danger" id="deleteHistoryBtn">XÃ³a</button>
                    </div>
                </div>
            </div>
            <div id="statisticsModal" class="modal">
                <div class="modal-content">
                    <button id="statistics-close-btn" style="position: absolute; top: 15px; right: 15px; width: 30px; height: 30px; border: none; background: #eee; border-radius: 50%; font-weight: bold; cursor: pointer;">X</button>
                    <h3 id="statistics-modalTitle" style="text-align: center;">Thá»‘ng kÃª káº¿t quáº£</h3>
                    <div id="statistics-content">
                        <div id="statistics-chart"></div>
                        <div id="statistics-legend"></div>
                    </div>
                </div>
            </div>
            <div id="comparisonModal" class="modal">
                <div class="modal-content">
                    <button id="comparison-help-btn" style="display: none;">?</button>
                    <div id="comparison-menu-btn" style="display: none;">
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    </div>
                    <h3 id="comparison-modalTitle"></h3>
                    <div id="comparison-content"></div>
                    <div class="button-group mt-4">
                        <button class="btn btn-secondary" onclick="closeComparisonModal()">Quay láº¡i</button>
                    </div>
                </div>
                <div id="small-search-menu" class="search-menu">
                    <h4>TÃ¬m CÃ¢u Nhanh</h4>
                    <div class="input-group">
                        <label for="dao-input">Äáº£o</label>
                        <input type="number" id="dao-input" placeholder="Sá»‘ Ä‘Ã£ Ä‘áº£o...">
                    </div>
                    <div class="input-group">
                        <label for="thuan-input">Thuáº­n</label>
                        <input type="number" id="thuan-input" placeholder="Sá»‘ gá»‘c...">
                    </div>
                    <div class="input-group" style="justify-content: flex-end; margin-bottom: 0;">
                        <span class="clear-btn" id="clear-small-search">xÃ³a</span>
                        <button class="icon-btn" id="exec-small-search">ğŸ”</button>
                    </div>
                </div>
                <div id="large-search-menu" class="search-menu">
                    <div class="search-controls">
                        <span class="clear-btn" id="clear-large-search">xÃ³a</span>
                        <div class="input-group">
                           <input type="text" id="large-search-input" placeholder="Nháº­p ná»™i dung cáº§n tÃ¬m...">
                        </div>
                        <button class="icon-btn" id="exec-large-search">ğŸ”</button>
                    </div>
                     <div id="large-search-results"></div>
                    <div class="nav-buttons">
                        <button class="btn btn-secondary" id="prev-match-btn">Quay láº¡i</button>
                        <button class="btn btn-secondary" id="next-match-btn">Káº¿ tiáº¿p</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="quiz-section" class="screen">
            <h2 id="quiz-title">Ná»™i dung bÃ i thi</h2>
            <div id="quiz-live-container"></div>
            <div id="results-container" style="display:none;">
                <h2>Káº¿t Quáº£</h2>
                <p id="final-score"></p>
            </div>
            <div class="button-group">
                <button id="start-btn" class="btn" style="display:none;"></button>
                <button id="shuffle-btn" class="btn" style="display:none;">Trá»™n cÃ¢u há»i vÃ  Ä‘Ã¡p Ã¡n: Táº¯t</button>
                <button id="submit-early-btn" class="btn btn-warning" style="display:none;">Ná»™p BÃ i Sá»›m</button>
                 <button class="btn btn-danger" onclick="showScreen('home-screen')">ThoÃ¡t</button>
            </div>
        </div>
        <button id="startQuizBtn" class="fixed-btn" style="display:none;">Báº¯t Äáº§u LÃ m BÃ i</button>
    </div>
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <h3>Trá»£ giÃºp & HÆ°á»›ng dáº«n</h3>
            <ul>
                <li><span class="icon">ğŸ¨</span><strong>MÃ u ná»n giá»‘ng nhau:</strong> CÃ¡c Ä‘Ã¡p Ã¡n cÃ³ cÃ¹ng mÃ u ná»n á»Ÿ cá»™t "gá»‘c" vÃ  cá»™t "xÃ¡o trá»™n" lÃ  cÃ¹ng má»™t Ä‘Ã¡p Ã¡n.</li>
                 <li><span class="icon" style="color: var(--success-color); font-weight: bold;">â– </span><strong style="color: var(--success-color);">Chá»¯ Xanh LÃ¡ & In Äáº­m:</strong> LÃ  Ä‘Ã¡p Ã¡n Ä‘Ãºng mÃ  báº¡n Ä‘Ã£ chá»n Ä‘Ãºng.</li>
                 <li><span class="icon" style="color: var(--success-color);">â– </span><span style="color: var(--success-color); text-decoration: underline;">Chá»¯ Xanh LÃ¡ & Gáº¡ch chÃ¢n:</span> LÃ  Ä‘Ã¡p Ã¡n Ä‘Ãºng báº¡n Ä‘Ã£ bá» sÃ³t.</li>
                 <li><span class="icon" style="color: var(--danger-color);">â– </span><strong style="color: var(--danger-color);">Chá»¯ Äá»:</strong> LÃ  Ä‘Ã¡p Ã¡n sai mÃ  báº¡n Ä‘Ã£ chá»n.</li>
                 <li><span class="icon">â˜°</span><strong>Menu tÃ¬m kiáº¿m (gÃ³c trÃªn bÃªn pháº£i):</strong>
                    <ul style="margin-left: 30px; margin-top: 10px; list-style-type: disc;">
                        <li><strong>Nháº¥n nhanh:</strong> Má»Ÿ menu tÃ¬m kiáº¿m nhanh theo sá»‘ thá»© tá»± cÃ¢u há»i.</li>
                        <li><strong>Nháº¥n giá»¯:</strong> Má»Ÿ thanh tÃ¬m kiáº¿m lá»›n á»Ÿ trÃªn cÃ¹ng Ä‘á»ƒ tÃ¬m theo ná»™i dung.</li>
                    </ul>
                </li>
            </ul>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="document.getElementById('helpModal').style.display='none'">ÄÃ£ hiá»ƒu</button>
            </div>
        </div>
    </div>
    
    <script>
        // ==================================================================
        // =================== KHU Vá»°C Dá»® LIá»†U BÃ€I THI =====================
        // ==================================================================
        const EMBEDDED_QUIZ_DATA = [
  {
    "cau_hoi": "CÃ¢u 1. Ná»™i dung nÃ o sau Ä‘Ã¢y khÃ´ng pháº£n Ã¡nh Ä‘Ãºng má»¥c tiÃªu cá»§a Äáº£ng vá» Chiáº¿n lÆ°á»£c báº£o vá»‡ Tá»• quá»‘c Viá»‡t Nam xÃ£ há»™i chá»§ nghÄ©a trong tÃ¬nh hÃ¬nh má»›i?",
    "lua_chon": [
      "*A.Káº¿t há»£p cháº·t cháº½ hai nhiá»‡m vá»¥: xÃ¢y dá»±ng vÃ  báº£o vá»‡ Tá»• quá»‘c xÃ£ há»™i chá»§ nghÄ©a.",
      "B. Báº£o vá»‡ vá»¯ng cháº¯c Ä‘á»™c láº­p, chá»§ quyá»n, thá»‘ng nháº¥t, toÃ n váº¹n lÃ£nh thá»• cá»§a Tá»• quá»‘c.",
      "C. Giá»¯ vá»¯ng mÃ´i trÆ°á»ng hÃ²a bÃ¬nh, á»•n Ä‘á»‹nh chÃ­nh trá»‹, an ninh quá»‘c gia, an ninh con ngÆ°á»i.",
      "D. Báº£o vá»‡ Äáº£ng, NhÃ  nÆ°á»›c, nhÃ¢n dÃ¢n, cháº¿ Ä‘á»™ xÃ£ há»™i chá»§ nghÄ©a, vÄƒn hÃ³a, lá»£i Ã­ch quá»‘c gia."
    ],
    "dap_an_dung": [
      "*A.Káº¿t há»£p cháº·t cháº½ hai nhiá»‡m vá»¥: xÃ¢y dá»±ng vÃ  báº£o vá»‡ Tá»• quá»‘c xÃ£ há»™i chá»§ nghÄ©a."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 2. Má»™t trong nhá»¯ng quan Ä‘iá»ƒm chá»‰ Ä‘áº¡o cá»§a Äáº£ng vá» Chiáº¿n lÆ°á»£c báº£o vá»‡ Tá»• quá»‘c Viá»‡t Nam xÃ£ há»™i chá»§ nghÄ©a trong tÃ¬nh hÃ¬nh má»›i lÃ .",
    "lua_chon": [
      "A.\tCoi ngoáº¡i lá»±c lÃ  nhÃ¢n tá»‘ quyáº¿t Ä‘á»‹nh má»i tháº¯ng lá»£i, thÃ nh cÃ´ng.",
      "*B. KiÃªn Ä‘á»‹nh má»¥c tiÃªu Ä‘á»™c láº­p dÃ¢n tá»™c gáº¯n liá»n vá»›i chá»§ nghÄ©a xÃ£ há»™i.",
      "C. Chá»‰ chÃº trá»ng xÃ¢y dá»±ng sá»©c máº¡nh cá»§a Ä‘áº¥t nÆ°á»›c vá» vÄƒn hÃ³a â€“ xÃ£ há»™i.",
      "D. Káº¿t há»£p cháº·t cháº½ hai nhiá»‡m vá»¥ chiáº¿n lÆ°á»£c: khÃ¡ng chiáº¿n vÃ  kiáº¿n quá»‘c."
    ],
    "dap_an_dung": [
      "*B. KiÃªn Ä‘á»‹nh má»¥c tiÃªu Ä‘á»™c láº­p dÃ¢n tá»™c gáº¯n liá»n vá»›i chá»§ nghÄ©a xÃ£ há»™i."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 3: Nhá»¯ng ai tÃ´n trá»ng Ä‘á»™ng láº­p chá»§ quyá»n, thiáº¿t láº­p vÃ  má»Ÿ rá»™ng quan há»‡ há»¯u nghá»‹, há»£p tÃ¡c bÃ¬nh Ä‘áº³ng,cÃ¹ng cÃ³ lá»£i vá»›i VN Ä‘á»u lÃ .",
    "lua_chon": [
      "*A. Ä‘á»‘i tÃ¡c.",
      "B. Ä‘á»‘i tÆ°á»£ng.",
      "C. káº» thÃ¹.",
      "D. Ä‘á»‘i thá»§"
    ],
    "dap_an_dung": [
      "*A. Ä‘á»‘i tÃ¡c."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 4. CÃ´ng Æ°á»›c cá»§a LiÃªn há»£p quá»‘c vá» Luáº­t Biá»ƒn nÄƒm 1982 bao gá»“m.",
    "lua_chon": [
      "*A. 320 Ä‘iá»u vÃ  9 phá»¥ lá»¥c.",
      "B. 7 chÆ°Æ¡ng vá»›i 55 Ä‘iá»u.",
      "C. 9 chÆ°Æ¡ng vá»›i 62 Ä‘iá»u.",
      "D. 36 Ä‘iá»u vÃ  8 phá»¥ lá»¥c."
    ],
    "dap_an_dung": [
      "*A. 320 Ä‘iá»u vÃ  9 phá»¥ lá»¥c."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 5. Theo quy Ä‘á»‹nh trong Luáº­t Biá»ƒn Viá»‡t Nam nÄƒm 2012, vÃ¹ng biá»ƒn Viá»‡t Nam gá»“m bao nhiÃªu bá»™ pháº­n?",
    "lua_chon": [
      "A. 3 bá»™ pháº­n.",
      "B. 4 bá»™ pháº­n.",
      "*C. 5 bá»™ pháº­n.",
      "D. 6 bá»™ pháº­n."
    ],
    "dap_an_dung": [
      "*C. 5 bá»™ pháº­n."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 6. VÃ¹ng nÆ°á»›c tiáº¿p giÃ¡p vá»›i bá» biá»ƒn, á»Ÿ phÃ­a trong Ä‘Æ°á»ng cÆ¡ sá»Ÿ Ä‘Æ°á»£c gá»i lÃ :",
    "lua_chon": [
      "*A. Ná»™i thá»§y.",
      "B. LÃ£nh háº£i.",
      "C. VÃ¹ng tiáº¿p giÃ¡p lÃ£nh háº£i.",
      "D. Thá»m lá»¥c Ä‘á»‹a."
    ],
    "dap_an_dung": [
      "*A. Ná»™i thá»§y."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 7. VÃ¹ng biÃªn tiáº¿p liá»n vÃ  náº±m ngoÃ i lÃ£nh háº£i Viá»‡t Nam, cÃ³ chiá»u rá»™ng 12 háº£i lÃ­ tÃ­nh tá»« ranh giá»›i ngoÃ i cá»§a lÃ£nh háº£i, Ä‘Æ°á»£c gá»i lÃ .",
    "lua_chon": [
      "A. Ná»™i thá»§y.",
      "*B. VÃ¹ng tiáº¿p giÃ¡p lÃ£nh háº£i.",
      "C. VÃ¹ng Ä‘áº·c quyá»n kinh táº¿.",
      "D. Thá»m lá»¥c Ä‘á»‹a."
    ],
    "dap_an_dung": [
      "*B. VÃ¹ng tiáº¿p giÃ¡p lÃ£nh háº£i."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 8. VÃ¹ng Ä‘Ã¡y biá»ƒn vÃ  lÃ²ng Ä‘áº¥t dÆ°á»›i Ä‘Ã¡y biá»ƒn, tiáº¿p liá»n vÃ  náº±m ngoÃ i lÃ£nh háº£i Viá»‡t Nam, trÃªn toÃ n bá»™ pháº§n kÃ©o dÃ i tá»± nhiÃªn cá»§a lÃ£nh thá»• Ä‘áº¥t liá»n, cÃ¡c Ä‘áº£o vÃ  quáº§n Ä‘áº£o cá»§a Viá»‡t Nam cho Ä‘áº¿n mÃ©p ngoÃ i cá»§a rÃ¬a lá»¥c Ä‘á»‹a, Ä‘Æ°á»£c gá»i lÃ .",
    "lua_chon": [
      "A. Ná»™i thá»§y.",
      "*D. Thá»m da lá»¥c Ä‘á»‹a.",
      "B. VÃ¹ng tiáº¿p giÃ¡p lÃ£nh háº£i.",
      "C. VÃ¹ng Ä‘áº·c quyá»n kinh táº¿."
    ],
    "dap_an_dung": [
      "*D. Thá»m da lá»¥c Ä‘á»‹a."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 9. â€œVÃ¹ng Ä‘áº¥t tá»± nhiÃªn cÃ³ nÆ°á»›c bao bá»c, khi thuá»· triá»u lÃªn vÃ¹ng Ä‘áº¥t nÃ y váº«n á»Ÿ trÃªn máº·t nÆ°á»›câ€ - Ä‘Ã³ lÃ  ná»™i dung cá»§a khÃ¡i niá»‡m nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "C. Ná»™i thá»§y.",
      "D. LÃ£nh háº£i.",
      "*A. Äáº£o.",
      "B. Quáº§n Ä‘áº£o."
    ],
    "dap_an_dung": [
      "*A. Äáº£o."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 10. NÆ°á»›c Cá»™ng hÃ²a xÃ£ há»™i chá»§ nghÄ©a Viá»‡t Nam lÃ  má»™t nÆ°á»›c Ä‘á»™c láº­p, cÃ³ chá»§ quyá»n, thá»‘ng nháº¥t vÃ  toÃ n váº¹n lÃ£nh thá»•, bao gá»“m:",
    "lua_chon": [
      "B. VÃ¹ng biá»ƒn vÃ  vÃ¹ng trá»i.",
      "A. Äáº¥t liá»n vÃ  háº£i Ä‘áº£o.",
      "C. VÃ¹ng Ä‘áº¥t vÃ¹ng trá»i vÃ  háº£i Ä‘áº£o.",
      "*D. Äáº¥t liá»n, háº£i Ä‘áº£o, vÃ¹ng biá»ƒn vÃ  vÃ¹ng trá»i."
    ],
    "dap_an_dung": [
      "*D. Äáº¥t liá»n, háº£i Ä‘áº£o, vÃ¹ng biá»ƒn vÃ  vÃ¹ng trá»i."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 11. BiÃªn giá»›i quá»‘c gia trÃªn biá»ƒn Ä‘Æ°á»£c hoáº¡ch Ä‘á»‹nh vÃ  Ä‘Ã¡nh dáº¥u báº±ng .",
    "lua_chon": [
      "A. Há»‡ tá»a Ä‘á»™ trÃªn Ä‘áº¥t liá»n.",
      "C. Há»‡ thá»‘ng má»‘c quá»‘c giá»›i.",
      "*B. CÃ¡c tá»a Ä‘á»™ trÃªn háº£i Ä‘á»“.",
      "D. Má»™t má»‘c quá»‘c giá»›i duy nháº¥t."
    ],
    "dap_an_dung": [
      "*B. CÃ¡c tá»a Ä‘á»™ trÃªn háº£i Ä‘á»“."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 12. â€œMáº·t tháº³ng Ä‘á»©ng tá»« biÃªn giá»›i quá»‘c gia trÃªn Ä‘áº¥t liá»n vÃ  biÃªn giá»›i quá»‘c gia trÃªn biá»ƒn lÃªn vÃ¹ng trá»iâ€ Ä‘Ã³ lÃ  ná»™i dung cá»§a khÃ¡i niá»‡m nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "A. BiÃªn giá»›i quá»‘c gia trÃªn biá»ƒn.",
      "*B. BiÃªn giá»›i quá»‘c gia trÃªn khÃ´ng.",
      "C. BiÃªn giá»›i quá»‘c gia trÃªn Ä‘áº¥t liá»n.",
      "D. BiÃªn giá»›i quá»‘c gia trong lÃ²ng Ä‘áº¥t."
    ],
    "dap_an_dung": [
      "*B. BiÃªn giá»›i quá»‘c gia trÃªn khÃ´ng."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 13. Trong báº£o vá»‡ biÃªn giá»›i quá»‘c gia cá»§a Viá»‡t Nam, phÃ¡p luáº­t Viá»‡t Nam khÃ´ng nghiÃªm cáº¥m thá»±c hiá»‡n hÃ nh vi nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "A. LÃ m sai lá»‡ch, chá»‡ch hÆ°á»›ng Ä‘i cá»§a Ä‘Æ°á»ng biÃªn giá»›i quá»‘c gia.",
      "B. Váº­n chuyá»ƒn qua biÃªn giá»›i quá»‘c gia cÃ¡c vÄƒn hoÃ¡ pháº©m Ä‘á»™c háº¡i.",
      "*C. Báº£o vá»‡ mÃ´i trÆ°á»ng, tÃ i nguyÃªn thiÃªn nhiÃªn vÃ  lá»£i Ã­ch quá»‘c gia.",
      "D. XÃ¢m canh, xÃ¢m cÆ°; phÃ¡ hoáº¡i cÃ´ng trÃ¬nh á»Ÿ khu vá»±c biÃªn giá»›i."
    ],
    "dap_an_dung": [
      "*C. Báº£o vá»‡ mÃ´i trÆ°á»ng, tÃ i nguyÃªn thiÃªn nhiÃªn vÃ  lá»£i Ã­ch quá»‘c gia."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 14. NgÃ y 03 thÃ¡ng 3 háº±ng nÄƒm lÃ  ngÃ y truyá»n thá»‘ng cá»§a lá»±c lÆ°á»£ng nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "*A. Bá»™ Ä‘á»™i BiÃªn phÃ²ng Viá»‡t Nam.",
      "C. CÃ´ng an nhÃ¢n dÃ¢n Viá»‡t Nam.",
      "B. QuÃ¢n Ä‘á»™i nhÃ¢n dÃ¢n Viá»‡t Nam.",
      "D. Háº£i quÃ¢n nhÃ¢n dÃ¢n Viá»‡t Nam."
    ],
    "dap_an_dung": [
      "*A. Bá»™ Ä‘á»™i BiÃªn phÃ²ng Viá»‡t Nam."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 15. Viá»‡t Nam cÃ³ Ä‘Æ°á»ng biÃªn giá»›i chung trÃªn Ä‘áº¥t liá»n vá»›i nhá»¯ng quá»‘c gia nÃ o?",
    "lua_chon": [
      "B. Mianma, Malaixia, InÄ‘Ã´nÃªxia.",
      "A. LÃ o, ThÃ¡i Lan, PhilÃ­ppin.",
      "*D. Trung Quá»‘c, LÃ o, Campuchia.",
      "C. LÃ o, Campuchia, ThÃ¡i Lan."
    ],
    "dap_an_dung": [
      "*D. Trung Quá»‘c, LÃ o, Campuchia."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 1. Äá»‘i tÆ°á»£ng Ä‘Äƒng kÃ­ nghÄ©a vá»¥ quÃ¢n sá»± gá»“m.",
    "lua_chon": [
      "*A. cÃ´ng dÃ¢n nam Ä‘á»§ 17 tuá»•i trá»Ÿ lÃªn; cÃ´ng dÃ¢n ná»¯ Ä‘á»§ 18 tuá»•i trá»Ÿ lÃªn.",
      "B. cÃ´ng dÃ¢n nam Ä‘á»§ 18 tuá»•i trá»Ÿ lÃªn; cÃ´ng dÃ¢n ná»¯ Ä‘á»§ 17 tuá»•i trá»Ÿ lÃªn.",
      "C. cÃ´ng dÃ¢n nam Ä‘á»§ 21 tuá»•i trá»Ÿ lÃªn; cÃ´ng dÃ¢n ná»¯ Ä‘á»§ 22 tuá»•i trá»Ÿ lÃªn.",
      "D. cÃ´ng dÃ¢n nam Ä‘á»§ 22 tuá»•i trá»Ÿ lÃªn; cÃ´ng dÃ¢n ná»¯ Ä‘á»§ 23 tuá»•i trá»Ÿ lÃªn."
    ],
    "dap_an_dung": [
      "*A. cÃ´ng dÃ¢n nam Ä‘á»§ 17 tuá»•i trá»Ÿ lÃªn; cÃ´ng dÃ¢n ná»¯ Ä‘á»§ 18 tuá»•i trá»Ÿ lÃªn."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 2. Chá»‰ huy trÆ°á»Ÿng Ban chá»‰ huy quÃ¢n sá»± cáº¥p huyá»‡n ra lá»‡nh gá»i cÃ´ng dÃ¢n Ä‘Äƒng kÃ­ nghÄ©a vá»¥ quÃ¢n sá»± Ä‘áº§u vÃ o thá»i gian nÃ o?",
    "lua_chon": [
      "A. ThÃ¡ng ba háº±ng nÄƒm.",
      "*B. ThÃ¡ng tÆ° háº±ng nÄƒm.",
      "C. ThÃ¡ng nÄƒm háº±ng nÄƒm.",
      "D. ThÃ¡ng sÃ¡u háº±ng nÄƒm."
    ],
    "dap_an_dung": [
      "*B. ThÃ¡ng tÆ° háº±ng nÄƒm."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 3: CÃ´ng dÃ¢n trá»±c tiáº¿p Ä‘Äƒng kÃ½ nghÄ©a vá»¥ quÃ¢n sá»± táº¡i.",
    "lua_chon": [
      "D. mang sau mang nam.",
      "*A. Ban Chá»‰ huy quÃ¢n sá»± cáº¥p xÃ£.",
      "C. Ban Chá»‰ huy quÃ¢n sá»± cÃ¢p huyá»‡n."
    ],
    "dap_an_dung": [
      "*A. Ban Chá»‰ huy quÃ¢n sá»± cáº¥p xÃ£."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 4. á» Viá»‡t Nam, cÃ´ng dÃ¢n Ä‘Æ°á»£c Ä‘Ã o táº¡o trÃ¬nh Ä‘á»™ cao Ä‘áº³ng  Ä‘áº¡i há»c Ä‘Ã£ Ä‘Æ°á»£c táº¡m hoÃ£n gá»i nháº­p ngÅ© Ä‘áº¿n háº¿t .",
    "lua_chon": [
      "A. 25 tuá»•i.",
      "*B. 27 tuá»•i.",
      "C. 29 tuá»•i.",
      "D. 31 tuá»•i."
    ],
    "dap_an_dung": [
      "*B. 27 tuá»•i."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 5. CÃ´ng dÃ¢n thuá»™c diá»‡n gá»i nháº­p ngÅ© Ä‘Æ°á»£c gá»i khÃ¡m sá»©c khá»e. Thá»i gian khÃ¡m sá»©c khá»e tá»« ngÃ y.",
    "lua_chon": [
      "*A. 01 thÃ¡ng 11 Ä‘áº¿n háº¿t ngÃ y 31 thÃ¡ng 12 háº±ng nÄƒm.",
      "B. 01 thÃ¡ng 1 Ä‘áº¿n háº¿t ngÃ y 28 thÃ¡ng 2 háº±ng nÄƒm.",
      "C. 01 thÃ¡ng 3 Ä‘áº¿n háº¿t ngÃ y 30 thÃ¡ng 4 háº±ng nÄƒm.",
      "D. 01 thÃ¡ng 5 Ä‘áº¿n háº¿t ngÃ y 30 thÃ¡ng 6 háº±ng nÄƒm."
    ],
    "dap_an_dung": [
      "*A. 01 thÃ¡ng 11 Ä‘áº¿n háº¿t ngÃ y 31 thÃ¡ng 12 háº±ng nÄƒm."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 6. CÃ´ng dÃ¢n thuá»™c trÆ°á»ng há»£p nÃ o sau Ä‘Ã¢y Ä‘Æ°á»£c táº¡m hoÃ£n gá»i nháº­p ngÅ©?",
    "lua_chon": [
      "*A . Äang Ä‘Æ°á»£c Ä‘Ã o táº¡o trÃ¬nh Ä‘á»™ Ä‘áº¡i há»c há»‡ chÃ­nh quy thuá»™c cÆ¡ sá»Ÿ giÃ¡o dá»¥c Ä‘áº¡i há»c.",
      "B. Äá»§ sá»©c khá»e phá»¥c vá»¥ táº¡i ngÅ© theo káº¿t luáº­n cá»§a Há»™i Ä‘á»“ng khÃ¡m sá»©c khá»e.",
      "C. CÃ³ anh, chá»‹ hoáº·c em há» lÃ  háº¡ sÄ© quan, binh sÄ© Ä‘ang phá»¥c vá»¥ táº¡i ngÅ©.",
      "D. CÃ³ ngÆ°á»i thÃ¢n bá»‹ suy giáº£m kháº£ nÄƒng lao Ä‘á»™ng tá»« 40 Ä‘áº¿n 60%."
    ],
    "dap_an_dung": [
      "*A . Äang Ä‘Æ°á»£c Ä‘Ã o táº¡o trÃ¬nh Ä‘á»™ Ä‘áº¡i há»c há»‡ chÃ­nh quy thuá»™c cÆ¡ sá»Ÿ giÃ¡o dá»¥c Ä‘áº¡i há»c."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 7. CÃ´ng dÃ¢n thuá»™c trÆ°á»ng há»£p nÃ o sau Ä‘Ã¢y Ä‘Æ°á»£c cÃ´ng nháº­n hoÃ n thÃ nh nghÄ©a vá»¥ quÃ¢n sá»± táº¡i ngÅ© trong thá»i bÃ¬nh?",
    "lua_chon": [
      "*A. DÃ¢n quÃ¢n thÆ°á»ng trá»±c cÃ³ Ã­t nháº¥t 24 thÃ¡ng phá»¥c vá»¥.",
      "B. Tham gia CÃ´ng an xÃ£ liÃªn tá»¥c tá»« Ä‘á»§ 24 thÃ¡ng trá»Ÿ lÃªn.",
      "C. Phá»¥c vá»¥ trÃªn tÃ u kiá»ƒm ngÆ° tá»« Ä‘á»§ 36 thÃ¡ng trá»Ÿ lÃªn.",
      "D. Phá»¥c vá»¥ trÃªn tÃ u kiá»ƒm ngÆ° tá»« Ä‘á»§ 12 thÃ¡ng trá»Ÿ lÃªn."
    ],
    "dap_an_dung": [
      "*A. DÃ¢n quÃ¢n thÆ°á»ng trá»±c cÃ³ Ã­t nháº¥t 24 thÃ¡ng phá»¥c vá»¥."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 8. á» thá»i bÃ¬nh, trong trÆ°á»ng há»£p Ä‘á»ƒ báº£o Ä‘áº£m nhiá»‡m vá»¥ sáºµn sÃ ng chiáº¿n Ä‘áº¥u hoáº·c Ä‘ang thá»±c hiá»‡n nhiá»‡m vá»¥ phÃ²ng, chá»‘ng thiÃªn tai, dá»‹ch bá»‡nh, cá»©u há»™, cá»©u náº¡n,... thá»i háº¡n táº¡i ngÅ© cá»§a háº¡ sÄ© quan, binh lÃ­nh Ä‘Æ°á»£c kÃ©o dÃ i nhÆ°ng khÃ´ng quÃ¡.",
    "lua_chon": [
      "A. 24 thÃ¡ng.",
      "B. 18 thÃ¡ng.",
      "C. 12 thÃ¡ng.",
      "*D. 6 thÃ¡ng."
    ],
    "dap_an_dung": [
      "*D. 6 thÃ¡ng."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 9. HÃ nh vi khÃ´ng Ä‘Äƒng kÃ­ nghÄ©a vá»¥ quÃ¢n sá»± láº§n Ä‘áº§u sáº½ bá»‹ xá»­ pháº¡t báº±ng hÃ¬nh thá»©c nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "A. Cáº£i táº¡o khÃ´ng giam giá»¯.",
      "B. TÃ¹ khÃ´ng thá»i háº¡n.",
      "C. TÃ¹ cÃ³ thá»i háº¡n.",
      "*D. Pháº¡t tiá»n."
    ],
    "dap_an_dung": [
      "*D. Pháº¡t tiá»n."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 10. Äá»‘i tÆ°á»£ng Ä‘Æ°á»£c tuyá»ƒn chá»n thá»±c hiá»‡n nghÄ©a vá»¥ tham gia cÃ´ng an nhÃ¢n dÃ¢n lÃ : cÃ´ng dÃ¢n nam.",
    "lua_chon": [
      "*A. trong Ä‘á»™ tuá»•i gá»i nháº­p ngÅ© Ä‘Ã£ Ä‘Äƒng kÃ­ nghÄ©a vá»¥ quÃ¢n sá»±.",
      "B. ngoÃ i Ä‘á»™ tuá»•i gá»i nháº­p ngÅ© Ä‘Ã£ hoÃ n thÃ nh nghÄ©a vá»¥ quÃ¢n sá»±.",
      "C. tá»« 18 Ä‘áº¿n háº¿t 27 tuá»•i, thuá»™c trÆ°á»ng há»£p miá»…n gá»i nháº­p ngÅ©.",
      "D. tá»« 18 Ä‘áº¿n háº¿t 45 tuá»•i, thuá»™c trÆ°á»ng há»£p táº¡m hoÃ£n gá»i nháº­p ngÅ©."
    ],
    "dap_an_dung": [
      "*A. trong Ä‘á»™ tuá»•i gá»i nháº­p ngÅ© Ä‘Ã£ Ä‘Äƒng kÃ­ nghÄ©a vá»¥ quÃ¢n sá»±."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 11. CÃ´ng dÃ¢n cÃ³ trÃ¡ch nhiá»‡m gÃ¬ trong thá»±c hiá»‡n nghÄ©a vá»¥ quÃ¢n sá»±?",
    "lua_chon": [
      "A. KhÃ´ng cháº¥p hÃ nh lá»‡nh gá»i kiá»ƒm tra, khÃ¡m sá»©c khá»e nghÄ©a vá»¥ quÃ¢n sá»±.",
      "B. Cá»‘ Ã½ khÃ´ng nháº­n lá»‡nh gá»i kiá»ƒm tra, khÃ¡m sá»©c khá»e nghÄ©a vá»¥ quÃ¢n sá»±.",
      "C. LÃ m sai lá»‡ch káº¿t quáº£ phÃ¢n loáº¡i sá»©c khá»e nháº±m trá»‘n trÃ¡nh nghÄ©a vá»¥ quÃ¢n sá»±.",
      "*D. Cháº¥p hÃ nh quy Ä‘á»‹nh cá»§a phÃ¡p luáº­t vá» Ä‘Äƒng kÃ­ vÃ  thá»±c hiá»‡n nghÄ©a vá»¥ quÃ¢n sá»±."
    ],
    "dap_an_dung": [
      "*D. Cháº¥p hÃ nh quy Ä‘á»‹nh cá»§a phÃ¡p luáº­t vá» Ä‘Äƒng kÃ­ vÃ  thá»±c hiá»‡n nghÄ©a vá»¥ quÃ¢n sá»±."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 12. CÃ´ng dÃ¢n Ä‘Æ°á»£c cÃ´ng nháº­n hoÃ n thÃ nh nghÄ©a vá»¥ quÃ¢n sá»± táº¡i ngÅ© trong thá»i bÃ¬nh khi cÃ³ thá»i gian phá»¥c vá»¥ trÃªn tÃ u kiÃªm ngÆ° tá»« Ä‘á»§.",
    "lua_chon": [
      "A. 12 thÃ¡ng trá»Ÿ lÃªn.",
      "B. 18 thÃ¡ng trá»Ÿ lÃªn.",
      "*C. 24 thÃ¡ng trá»Ÿ lÃªn.",
      "D. 30 thÃ¡ng trá»Ÿ lÃªn."
    ],
    "dap_an_dung": [
      "*C. 24 thÃ¡ng trá»Ÿ lÃªn."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 1. Ná»™i dung nÃ o sau Ä‘Ã¢y khÃ´ng pháº£n Ã¡nh Ä‘Ãºng vá» khÃ¡i niá»‡m â€œtá»™i pháº¡mâ€?",
    "lua_chon": [
      "A. Do phÃ¡p nhÃ¢n thÆ°Æ¡ng máº¡i thá»±c hiá»‡n má»™t cÃ¡ch vÃ´ Ã½ hoáº·c cá»‘ Ã½.",
      "B. Do ngÆ°á»i máº¥t nÄƒng lá»±c trÃ¡ch nhiá»‡m hÃ¬nh sá»± thá»±c hiá»‡n má»™t cÃ¡ch cá»‘ Ã½.",
      "C. LÃ  hÃ nh vi nguy hiá»ƒm cho xÃ£ há»™i Ä‘Æ°á»£c quy Ä‘á»‹nh trong Bá»™ luáº­t HÃ¬nh sá»±.",
      "*D . Do ngÆ°á»i cÃ³ nÄƒng lá»±c trÃ¡ch nhiá»‡m hÃ¬nh sá»± thá»±c hiá»‡n má»™t cÃ¡ch vÃ´ Ã½ hoáº·c cá»‘ Ã½."
    ],
    "dap_an_dung": [
      "*D. Do ngÆ°á»i cÃ³ nÄƒng lá»±c trÃ¡ch nhiá»‡m hÃ¬nh sá»± thá»±c hiá»‡n má»™t cÃ¡ch vÃ´ Ã½ hoáº·c cá»‘ Ã½."
    "
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 2. Trong Bá»™ luáº­t HÃ¬nh sá»± nÄƒm 2015, sá»­a Ä‘á»•i, bá»• sung nÄƒm 2017 cÃ³ bao nhiÃªu chÆ°Æ¡ng quy Ä‘á»‹nh vá» hÃ¬nh pháº¡t cÃ¡c tá»™i pháº¡m?",
    "lua_chon": [
      "A. 12 chÆ°Æ¡ng.",
      "B. 13 chÆ°Æ¡ng.",
      "*C. 14 chÆ°Æ¡ng.",
      "D. 15 chÆ°Æ¡ng."
    ],
    "dap_an_dung": [
      "*C. 14 chÆ°Æ¡ng."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 3: Ná»™i dung nÃ o sau Ä‘Ã¢y khÃ´ng pháº£n Ã¡nh Ä‘Ãºng nhá»¯ng cÃ¡ch thá»©c hoáº¡t Ä‘á»™ng phá»• biáº¿n cá»§a tá»™i pháº¡m?",
    "lua_chon": [
      "A. Do phÃ¡p nhÃ¢n thÆ°Æ¡ng máº¡i thá»±c hiá»‡n má»™t cÃ¡ch vÃ´ Ã½ hoáº·c cá»‘ Ã½.",
      "B. Do ngÆ°á»i máº¥t nÄƒng lá»±c trÃ¡ch nhiá»‡m hÃ¬nh sá»± thá»±c hiá»‡n má»™t cÃ¡ch cá»‘ Ã½.",
      "C. LÃ  hÃ nh vi nguy hiá»ƒm cho xÃ£ há»™i Ä‘Æ°á»£c quy Ä‘á»‹nh trong Bá»™ luáº­t HÃ¬nh sá»±.",
      "*D . Do ngÆ°á»i cÃ³ nÄƒng lá»±c trÃ¡ch nhiá»‡m hÃ¬nh sá»± thá»±c hiá»‡n má»™t cÃ¡ch vÃ´ Ã½ hoáº·c cá»‘ Ã½."
    ],
    "dap_an_dung": [
      "*D. Do ngÆ°á»i cÃ³ nÄƒng lá»±c trÃ¡ch nhiá»‡m hÃ¬nh sá»± thá»±c hiá»‡n má»™t cÃ¡ch vÃ´ Ã½ hoáº·c cá»‘ Ã½."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 4. Tá»™i pháº¡m sá»­ dá»¥ng cÃ´ng nghá»‡ cao lÃ  nhá»¯ng hÃ nh vi vi pháº¡m.",
    "lua_chon": [
      "*A. phÃ¡p luáº­t hÃ¬nh sá»±.",
      "B. phÃ¡p luáº­t dÃ¢n sá»±.",
      "C. phÃ¡p luáº­t lao Ä‘á»™ng.",
      "D. phÃ¡p luáº­t tÃ´ tá»¥ng."
    ],
    "dap_an_dung": [
      "*A. phÃ¡p luáº­t hÃ¬nh sá»±."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 5. HÃ nh vi sáº£n xuáº¥t, mua bÃ¡n, trao Ä‘á»•i hoáº·c táº·ng cho cÃ´ng cá»¥, thiáº¿t bá»‹, pháº§n má»m Ä‘á»ƒ sá»­ dá»¥ng vÃ o má»¥c Ä‘Ã­ch trÃ¡i phÃ¡p luáº­t sáº½ bá»‹ xá»­ pháº¡t theo nhá»¯ng hÃ¬nh thá»©c nÃ o?",
    "lua_chon": [
      "A. Cáº£nh cÃ¡o hoáº·c pháº¡t tiá»n.",
      "B. Cáº£nh cÃ¡o, pháº¡t tiá»n vÃ  pháº¡t tá»­ hÃ¬nh.",
      "C. Cáº£i táº¡o khÃ´ng giam giá»¯ hoáº·c cáº£nh cÃ¡o.",
      "*D. Pháº¡t tiá»n, pháº¡t cáº£i táº¡o khÃ´ng giam giá»¯ hoáº·c pháº¡t tÃ¹."
    ],
    "dap_an_dung": [
      "*D. Pháº¡t tiá»n, pháº¡t cáº£i táº¡o khÃ´ng giam giá»¯ hoáº·c pháº¡t tÃ¹."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 6. Äiá»n cá»¥m tá»« thÃ­ch há»£p vÃ o chá»— trá»‘ng (....) trong khÃ¡i niá»‡m sau Ä‘Ã¢y: â€œ.. lÃ  hiá»‡n tÆ°á»£ng xÃ£ há»™i tiÃªu cá»±c, cÃ³ tÃ­nh phá»• biáº¿n, lan truyá»n, biá»ƒu hiá»‡n báº±ng nhá»¯ng hÃ nh vi vi pháº¡m phÃ¡p luáº­t, lá»‡ch chuáº©n má»±c xÃ£ há»™i, chuáº©n má»±c Ä‘áº¡o Ä‘á»©c, gÃ¢y nguy hiá»ƒm cho xÃ£ há»™iâ€?",
    "lua_chon": [
      "*A. Tá»‡ náº¡n xÃ£ há»™i.",
      "C. Báº¡o lá»±c há»c Ä‘Æ°á»ng.",
      "B. Báº¡o lá»±c gia Ä‘Ã¬nh.",
      "D. Tá»™i pháº¡m hÃ¬nh sá»±."
    ],
    "dap_an_dung": [
      "*A. Tá»‡ náº¡n xÃ£ há»™i."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 7. Tá»‡ náº¡n máº¡i dÃ¢m lÃ  cÃ¡c hÃ nh vi.",
    "lua_chon": [
      "A. sá»­ dá»¥ng trÃ¡i phÃ©p cháº¥t ma tuÃ½, nghiá»‡n ma tuÃ½, vi pháº¡m phÃ¡p luáº­t vá» ma tuÃ½.",
      "*B. mua dÃ¢m, bÃ¡n dÃ¢m vÃ  cÃ¡c hÃ nh vi khÃ¡c cÃ³ liÃªn quan Ä‘áº¿n mua dÃ¢m, bÃ¡n dÃ¢m.",
      "C. tin vÃ o nhá»¯ng Ä‘iá»u mÆ¡ há»“ dáº«n Ä‘áº¿n cuá»“ng tÃ­n, hÃ nh Ä‘á»™ng trÃ¡i vá»›i chuáº©n má»±c xÃ£ há»™i.",
      "D. lá»£i dá»¥ng trÃ² chÆ¡i Ä‘á»ƒ cÃ¡ cÆ°á»£c, sÃ¡t pháº¡t Ä‘Æ°á»£c thua báº±ng tiá»n hoáº·c lá»£i Ã­ch váº­t cháº¥t khÃ¡c."
    ],
    "dap_an_dung": [
      "*B. mua dÃ¢m, bÃ¡n dÃ¢m vÃ  cÃ¡c hÃ nh vi khÃ¡c cÃ³ liÃªn quan Ä‘áº¿n mua dÃ¢m, bÃ¡n dÃ¢m."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 8. Tá»‡ náº¡n cá» báº¡c lÃ  cÃ¡c hÃ nh vi.",
    "lua_chon": [
      "A. sá»­ dá»¥ng trÃ¡i phÃ©p cháº¥t ma tuÃ½, nghiá»‡n ma tuÃ½, vi pháº¡m phÃ¡p luáº­t vá» ma tuÃ½.",
      "B. mua dÃ¢m, bÃ¡n dÃ¢m vÃ  cÃ¡c hÃ nh vi khÃ¡c cÃ³ liÃªn quan Ä‘áº¿n mua dÃ¢m, bÃ¡n dÃ¢m.",
      "C. tin vÃ o nhá»¯ng Ä‘iá»u mÆ¡ há»“ dáº«n Ä‘áº¿n cuá»“ng tÃ­n, hÃ nh Ä‘á»™ng trÃ¡i vá»›i chuáº©n má»±c xÃ£ há»™i.",
      "*D. lá»£i dá»¥ng trÃ² chÆ¡i Ä‘á»ƒ cÃ¡ cÆ°á»£c, sÃ¡t pháº¡t Ä‘Æ°á»£c thua báº±ng tiá»n hoáº·c lá»£i Ã­ch váº­t cháº¥t khÃ¡c."
    ],
    "dap_an_dung": [
      "*D. lá»£i dá»¥ng trÃ² chÆ¡i Ä‘á»ƒ cÃ¡ cÆ°á»£c, sÃ¡t pháº¡t Ä‘Æ°á»£c thua báº±ng tiá»n hoáº·c lá»£i Ã­ch váº­t cháº¥t khÃ¡c."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 9. CÃ¢u ca dao â€œBáº¡c ba quan tha há»“ má»Ÿ bÃ¡t/ ChÃ¡o ba Ä‘á»“ng chÃª Ä‘áº¯t khÃ´ng Äƒnâ€ pháº£n Ã¡nh vá» loáº¡i tá»‡ náº¡n xÃ£ há»™i nÃ o dÆ°á»›i Ä‘Ã¢y?",
    "lua_chon": [
      "*B. Tá»‡ náº¡n cá» báº¡c.",
      "A. Tá»‡ náº¡n ma tÃºy.",
      "D. Tá»‡ náº¡n mÃª tÃ­n dá»‹ Ä‘oan.",
      "C. Tá»‡ náº¡n máº¡i dÃ¢m."
    ],
    "dap_an_dung": [
      "*B. Tá»‡ náº¡n cá» báº¡c."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 10. CÃ¢u tá»¥c ngá»¯ nÃ o sau Ä‘Ã¢y pháº£n Ã¡nh vá» tá»‡ náº¡n mÃª tÃ­n dá»‹ Ä‘oan?",
    "lua_chon": [
      "A. ÄÃ¡nh Ä‘á» ra Ä‘Ãª mÃ  á»Ÿ.",
      "*B. BÃ³i ra ma, quÃ©t nhÃ  ra rÃ¡c.",
      "C. Äi cuá»‘c Ä‘au tay, Ä‘i cÃ y má»i gá»‘i.",
      "D. Nhá»‹n Ä‘Ã³i nÄƒm co hÆ¡n Äƒn no vÃ¡c náº·ng."
    ],
    "dap_an_dung": [
      "*B. BÃ³i ra ma, quÃ©t nhÃ  ra rÃ¡c."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 11. Trong dá»‹p Táº¿t NguyÃªn Ä‘Ã¡n, P rá»§ máº¥y báº¡n Ä‘áº¿n nhÃ  Ä‘Ã¡nh tÃº lÆ¡ khÆ¡ Äƒn tiá»n. Náº¿u nháº­n Ä‘Æ°á»£c lá»i má»i cá»§a P, em nÃªn lá»±a chá»n cÃ¡ch á»©ng xá»­ nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "A. Láº­p tá»©c Ä‘á»“ng Ã½ Ä‘áº¿n nhÃ  P chÆ¡i Ä‘Ã¡nh bÃ i Äƒn tiá»n.",
      "B. Tá»« chá»‘i nhÆ°ng váº«n Ä‘áº¿n nhÃ  P Ä‘á»ƒ xem cÃ¡c báº¡n chÆ¡i.",
      "*C. Tá»« chá»‘i vÃ  khuyÃªn P khÃ´ng nÃªn thá»±c hiá»‡n hÃ nh vi Ä‘Ã³.",
      "D. Äá»“ng Ã½ vÃ  rá»§ thÃªm cÃ¡c báº¡n khÃ¡c cÃ¹ng tham gia cho vui."
    ],
    "dap_an_dung": [
      "*C. Tá»« chá»‘i vÃ  khuyÃªn P khÃ´ng nÃªn thá»±c hiá»‡n hÃ nh vi Ä‘Ã³."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 12. Xá»­ pháº¡t vi pháº¡m hÃ nh chÃ­nh Ä‘á»‘i vá»›i cÃ¡ nhÃ¢n, tá»• chá»©c cÃ³ hÃ nh vi.",
    "lua_chon": [
      "*A. tham gia hoáº·c tá»• chá»©c hoáº¡t Ä‘á»™ng mÃª tÃ­n dá»‹ Ä‘oan trong lá»… há»™i.",
      "B. dÃ¹ng bÃ³i toÃ¡n Ä‘á»ƒ thu lá»£i báº¥t chÃ­nh tá»« 200 triá»‡u Ä‘á»“ng trá»Ÿ lÃªn.",
      "C. dÃ¹ng bÃ³i toÃ¡n, Ä‘á»“ng bÃ³ng gÃ¢y áº£nh hÆ°á»Ÿng xáº¥u Ä‘áº¿n an toÃ n xÃ£ há»™i.",
      "D. sá»­ dá»¥ng cÃ¡c hÃ¬nh thá»©c mÃª tÃ­n dá»‹ Ä‘oan dáº«n Ä‘áº¿n cháº¿t ngÆ°á»i."
    ],
    "dap_an_dung": [
      "*A. tham gia hoáº·c tá»• chá»©c hoáº¡t Ä‘á»™ng mÃª tÃ­n dá»‹ Ä‘oan trong lá»… há»™i."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 13. PhÃ¡p luáº­t Viá»‡t Nam khÃ´ng nghiÃªm cáº¥m thá»±c hiá»‡n hÃ nh vi nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "A. Mua dÃ¢m; bÃ¡n dÃ¢m vÃ  tá»• chá»©c hoáº¡t Ä‘á»™ng máº¡i dÃ¢m.",
      "*B. Tá»‘ giÃ¡c hÃ nh vi: mua dÃ¢m, bÃ¡n dÃ¢m, chá»©a máº¡i dÃ¢m.",
      "C. Lá»£i dá»¥ng kinh doanh dá»‹ch vá»¥ Ä‘á»ƒ hoáº¡t Ä‘á»™ng máº¡i dÃ¢m.",
      "D. CÆ°á»¡ng bá»©c, mÃ´i giá»›i máº¡i dÃ¢m vÃ  báº£o kÃª máº¡i dÃ¢m."
    ],
    "dap_an_dung": [
      "*B. Tá»‘ giÃ¡c hÃ nh vi: mua dÃ¢m, bÃ¡n dÃ¢m, chá»©a máº¡i dÃ¢m."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 14. Ná»™i dung nÃ o sau Ä‘Ã¢y khÃ´ng pháº£n Ã¡nh Ä‘Ãºng trÃ¡ch nhiá»‡m cá»§a há»c sinh trong viá»‡c phÃ²ng chá»‘ng tá»‡ náº¡n xÃ£ há»™i?",
    "lua_chon": [
      "A. Há»c táº­p Ä‘áº§y Ä‘á»§ cÃ¡c ná»™i dung giÃ¡o dá»¥c vá» phÃ²ng, chá»‘ng tá»‡ náº¡n xÃ£ há»™i.",
      "B. Tá»± giÃ¡c thá»±c hiá»‡n trÃ¡ch nhiá»‡m cÃ´ng dÃ¢n trong phÃ²ng, chá»‘ng tá»‡ náº¡n xÃ£ há»™i.",
      "C. GÆ°Æ¡ng máº«u thá»±c hiá»‡n quy Ä‘á»‹nh cá»§a phÃ¡p luáº­t, quy táº¯c sinh hoáº¡t cá»™ng Ä‘á»“ng.",
      "*D. KhÃ´ng tham gia hoáº¡t Ä‘á»™ng phÃ²ng chá»‘ng tá»‡ náº¡n xÃ£ há»™i do Ä‘á»‹a phÆ°Æ¡ng tá»• chá»©c."
    ],
    "dap_an_dung": [
      "*D. KhÃ´ng tham gia hoáº¡t Ä‘á»™ng phÃ²ng chá»‘ng tá»‡ náº¡n xÃ£ há»™i do Ä‘á»‹a phÆ°Æ¡ng tá»• chá»©c."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": ". CÃ¢u 15. Chá»§ thá»ƒ nÃ o dÆ°á»›i Ä‘Ã¢y khÃ´ng vi pháº¡m phÃ¡p luáº­t vá» phÃ²ng, chá»‘ng tá»‡ náº¡n xÃ£ há»™i?",
    "lua_chon": [
      "*A. Chá»‹ V tá»‘ cÃ¡o vá»›i cÆ¡ quan cÃ´ng an vá» hÃ nh vi tá»• chá»©c Ä‘Ã¡nh báº¡c cá»§a Ã´ng P.",
      "B. Anh K lá»£i dá»¥ng viá»‡c kinh doanh dá»‹ch vá»¥ massage Ä‘á»ƒ mÃ´i giá»›i máº¡i dÃ¢m.",
      "C. Báº¡n K váº­n chuyá»ƒn giÃºp Ã´ng C 200g ma tÃºy Ä‘á»ƒ nháº­n 1 triá»‡u Ä‘á»“ng tiá»n cÃ´ng.",
      "D. BÃ  S tung tin mÃ¬nh Ä‘Æ°á»£c â€œthÃ¡nh cho Äƒn lá»™câ€ Ä‘á»ƒ tá»• chá»©c hoáº¡t Ä‘á»™ng bÃ³i toÃ¡n."
    ],
    "dap_an_dung": [
      "*A. Chá»‹ V tá»‘ cÃ¡o vá»›i cÆ¡ quan cÃ´ng an vá» hÃ nh vi tá»• chá»©c Ä‘Ã¡nh báº¡c cá»§a Ã´ng P."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 1. Äiá»n cá»¥m tá»« thÃ­ch há»£p vÃ o chá»— trá»‘ng (......) trong khÃ¡i niá»‡m sau Ä‘Ã¢y: â€œ...... váº­t cháº¥t tá»± nhiÃªn vÃ  nhÃ¢n táº¡o quan há»‡ máº­t thiáº¿t vá»›i nhau, bao quanh con ngÆ°á»i, cÃ³ áº£nh hÆ°á»Ÿng Ä‘áº¿n Ä‘á»i sá»‘ng,kinh táº¿, xÃ£ há»™i, sá»± tá»“n táº¡i, phÃ¡t triá»ƒn cá»§a con ngÆ°á»i, sinh váº­t vÃ  tá»± nhiÃªnâ€.",
    "lua_chon": [
      "*A. MÃ´i trÆ°á»ng.",
      "B. KhÃ´ng khÃ­.",
      "C. Sinh váº­t.",
      "D. Há»‡ sinh thÃ¡i."
    ],
    "dap_an_dung": [
      "*A. MÃ´i trÆ°á»ng."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 2. Yáº¿u tá»‘ váº­t cháº¥t nÃ o dÆ°á»›i Ä‘Ã¢y khÃ´ng pháº£i lÃ  thÃ nh pháº§n cá»§a mÃ´i trÆ°á»ng tá»± nhiÃªn?",
    "lua_chon": [
      "A. KhÃ´ng khÃ­.",
      "B. Sinh váº­t.",
      "C. Ãnh sÃ¡ng.",
      "*D. DÃ¢n cÆ°."
    ],
    "dap_an_dung": [
      "*D. DÃ¢n cÆ°."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 3: â€œ Sá»± biáº¿n Ä‘á»•i tÃ­nh cháº¥t váº­t lÃ½, hÃ³a há»c, sinh há»c cá»§a thÃ nh pháº§n mÃ´i trÆ°á»ng khÃ´ng phÃ¹ há»£p vá»›i quy chuáº©n kÄ© thuáº­t mÃ´i trÆ°á»ng gÃ¢y áº£nh hÆ°á»Ÿng xáº¥u Ä‘áº¿n sá»©c khá»e con ngÆ°á»i, sinh váº­t tá»± nhiÃªnâ€ â€“ lÃ  ná»™i dung cá»§a khÃ¡i niá»‡m nÃ o?",
    "lua_chon": [
      "A. Báº£o vá»‡ mÃ´i trÆ°á»ng",
      "*B. Ã” nhiá»…m mÃ´i trÆ°á»ng.",
      "C. An ninh mÃ´i trÆ°á»ng.",
      "D. Biáº¿n Ä‘á»•i khÃ­ háº­u."
    ],
    "dap_an_dung": [
      "*B. Ã” nhiá»…m mÃ´i trÆ°á»ng."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 4. Ná»™i dung nÃ o sau Ä‘Ã¢y khÃ´ng pháº£n Ã¡nh Ä‘Ãºng Ã½ nghÄ©a cá»§a mÃ´i trÆ°á»ng?",
    "lua_chon": [
      "A. Cung cáº¥p tÃ i nguyÃªn cáº§n thiáº¿t cho cuá»™c sá»‘ng vÃ  sáº£n xuáº¥t cá»§a con ngÆ°á»i.",
      "B. Chá»©a Ä‘á»±ng cÃ¡c cháº¥t pháº¿ tháº£i do con ngÆ°á»i táº¡o ra trong sáº£n xuáº¥t vÃ  cuá»™c sá»‘ng.",
      "*C. LÃ  khÃ´ng gian sá»‘ng vÃ  lÃ  nÆ¡i cung cáº¥p, lÆ°u trá»¯ thÃ´ng tin cá»§a riÃªng loÃ i ngÆ°á»i.",
      "D. LÃ  nÆ¡i lÆ°u giá»¯ lá»‹ch sá»­ tiáº¿n hoÃ¡ cá»§a con ngÆ°á»i, cÃ¡c loÃ i sinh váº­t vÃ  TrÃ¡i Äáº¥t."
    ],
    "dap_an_dung": [
      "*C. LÃ  khÃ´ng gian sá»‘ng vÃ  lÃ  nÆ¡i cung cáº¥p, lÆ°u trá»¯ thÃ´ng tin cá»§a riÃªng loÃ i ngÆ°á»i."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 5. Äiá»n cá»¥m tá»« thÃ­ch há»£p vÃ o chá»— trá»‘ng (......) trong khÃ¡i niá»‡m sau Ä‘Ã¢y: â€œ. tá»‘ cáº¥u thÃ nh mÃ´i trÆ°á»ng cÃ¢n báº±ng Ä‘á»ƒ báº£o Ä‘áº£m Ä‘iá»u kiá»‡n sá»‘ng vÃ  phÃ¡t triá»ƒn cá»§a con ngÆ°á»i cÃ¹ng cÃ¡c loÃ i sinh lÃ  há»‡ thá»‘ng cÃ¡c loÃ i sinh váº­t trong há»‡ thá»‘ng Ä‘Ã³.",
    "lua_chon": [
      "A. Báº£o vá»‡ mÃ´i trÆ°á»ng.",
      "*C. An ninh mÃ´i trÆ°á»ng.",
      "D. Biáº¿n Ä‘á»•i khÃ­ háº­u.",
      "B. Ã” nhiá»…m mÃ´i trÆ°á»ng."
    ],
    "dap_an_dung": [
      "*C. An ninh mÃ´i trÆ°á»ng."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 6. â€œSá»± thay Ä‘á»•i cá»§a khÃ­ háº­u chá»§ yáº¿u do hoáº¡t Ä‘á»™ng cá»§a con ngÆ°á»i lÃ m thay Ä‘á»•i thÃ nh pháº§n khÃ­ quyá»n toÃ n cáº§u vÃ  sá»± thay Ä‘á»•i nÃ y lÃ m tÄƒng kháº£ nÄƒng biáº¿n Ä‘á»™ng tá»± nhiÃªn cá»§a khÃ­ háº­uâ€ - Ä‘Ã³ lÃ  ná»™i dung cá»§a khÃ¡i niá»‡m nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "A. Báº£o vá»‡ mÃ´i trÆ°á»ng.",
      "B. Ã” nhiá»…m mÃ´i trÆ°á»ng.",
      "C. An ninh mÃ´i trÆ°á»ng.",
      "*D. Biáº¿n Ä‘á»•i khÃ­ háº­u."
    ],
    "dap_an_dung": [
      "*D. Biáº¿n Ä‘á»•i khÃ­ háº­u."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 7. Ná»™i dung nÃ o sau Ä‘Ã¢y khÃ´ng pháº£n Ã¡nh Ä‘Ãºng biá»ƒu hiá»‡n cá»§a biáº¿n Ä‘á»•i khÃ­ háº­u?",
    "lua_chon": [
      "A. Má»±c nÆ°á»›c biá»ƒn dÃ¢ng cao",
      "B. LÆ°á»£ng mÆ°a thay Ä‘á»•i tháº¥t thÆ°á»ng.",
      "C. Nhiá»‡t Ä‘á»™ trung bÃ¬nh toÃ n cáº§u tÄƒng cao.",
      "*D. Giáº£m cÃ¡c hiá»‡n tÆ°á»£ng thá»i tiáº¿t cá»±c Ä‘oan ."
    ],
    "dap_an_dung": [
      "*D. Giáº£m cÃ¡c hiá»‡n tÆ°á»£ng thá»i tiáº¿t cá»±c Ä‘oan ."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 8. Váº¥n Ä‘á» nÃ o dÆ°á»›i Ä‘Ã¢y khÃ´ng liÃªn quan Ä‘áº¿n an ninh mÃ´i trÆ°á»ng?",
    "lua_chon": [
      "A. ThiÃªn tai.",
      "B. Dá»‹ch bá»‡nh.",
      "*C. An ninh thÃ´ng tin.",
      "D. An ninh lÆ°Æ¡ng thá»±c."
    ],
    "dap_an_dung": [
      "*C. An ninh thÃ´ng tin."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 9. Ná»™i dung nÃ o sau Ä‘Ã¢y khÃ´ng pháº£n Ã¡nh Ä‘Ãºng cÃ¡c tÃ¡c nhÃ¢n tiÃªu cá»±c dáº«n Ä‘áº¿n viá»‡c di cÆ° tá»± do?",
    "lua_chon": [
      "A. Äáº¥t canh tÃ¡c bá»‹ Ã´ nhiá»…m, suy thoÃ¡i.",
      "*B. MÃ´i trÆ°á»ng khÃ´ng khÃ­ trong lÃ nh.",
      "C. TÃ i nguyÃªn suy giáº£m, cáº¡n kiá»‡t.",
      "D. Há»‡ sinh bá»‹ phÃ¡ há»§y."
    ],
    "dap_an_dung": [
      "*B. MÃ´i trÆ°á»ng khÃ´ng khÃ­ trong lÃ nh."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 10. Báº£o vá»‡ mÃ´i trÆ°á»ng khÃ´ng bao gá»“m hoáº¡t Ä‘á»™ng nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "A. Cáº£i thiá»‡n cháº¥t lÆ°á»£ng mÃ´i trÆ°á»ng.",
      "B. á»¨ng phÃ³ vá»›i cÃ¡c sá»± cá»‘ mÃ´i trÆ°á»ng.",
      "C. Kháº¯c phá»¥c Ã´ nhiá»…m, suy thoÃ¡i mÃ´i trÆ°á»ng.",
      "*D. Khai thÃ¡c cáº¡n kiá»‡t tÃ i nguyÃªn thiÃªn nhiÃªn."
    ],
    "dap_an_dung": [
      "*D. Khai thÃ¡c cáº¡n kiá»‡t tÃ i nguyÃªn thiÃªn nhiÃªn."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  },
  {
    "cau_hoi": "CÃ¢u 11. Äá»ƒ báº£o vá»‡ mÃ´i trÆ°á»ng Ä‘áº¥t, chÃºng ta khÃ´ng nÃªn thá»±c hiá»‡n biá»‡n phÃ¡p nÃ o sau Ä‘Ã¢y?",
    "lua_chon": [
      "*A. Láº¡m dá»¥ng thuá»‘c báº£o vá»‡ thá»±c váº­t vÃ  phÃ¢n bÃ³n hÃ³a há»c trong sáº£n xuáº¥t.",
      "B. NÃ¢ng cao Ã½ thá»©c trÃ¡ch nhiá»‡m báº£o vá»‡ mÃ´i trÆ°á»ng Ä‘áº¥t cá»§a cá»™ng Ä‘á»“ng cÆ° dÃ¢n.",
      "C. NhÃ  nÆ°á»›c tiáº¿n hÃ nh cáº£i táº¡o, phá»¥c há»“i mÃ´i trÆ°á»ng Ä‘áº¥t á»Ÿ cÃ¡c khu vá»±c Ã´ nhiá»…m.",
      "D. Xem xÃ©t tÃ¡c Ä‘á»™ng vÃ  cÃ³ giáº£i phÃ¡p phÃ²ng ngá»«a Ã´ nhiá»…m trÆ°á»›c khi quy hoáº¡ch."
    ],
    "dap_an_dung": [
      "*A. Láº¡m dá»¥ng thuá»‘c báº£o vá»‡ thá»±c váº­t vÃ  phÃ¢n bÃ³n hÃ³a há»c trong sáº£n xuáº¥t."
    ],
    "type": "multiple_choice",
    "hasLineMarker": false,
    "blockType": "tráº¯c"
  }
] ;

        // ==================================================================
        // =================== KHAI BÃO Ã‚M THANH ============================
        // ==================================================================
        const backgroundMusic = new Audio('./sounds/background.mp3');
        const correctAnswerSound = new Audio('./sounds/correct.mp3');
        const incorrectAnswerSound = new Audio('./sounds/incorrect.mp3');
        
        // Cáº¥u hÃ¬nh Ã¢m thanh
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.3; // Nháº¡c ná»n nÃªn nhá» hÆ¡n
        correctAnswerSound.volume = 0.8;
        incorrectAnswerSound.volume = 0.8;
        // ==================================================================

        const optionMarkerRegex = /(?<=(?:^|\n|\t|[*.?]\s*))\*?\s*[A-Za-z]{1,2}[.)]/g;
        const optionPrefixRegex = /^\s*\*?\s*[A-Za-z]{1,2}[.)]/;
        
        function escapeHtml(text) {
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        const pillColorConfig = {
            baseClasses: 'px-4 py-2 rounded-full text-white font-semibold shadow-md transition-transform transform hover:scale-105',
            selectedClasses: 'bg-gray-500 hover:bg-gray-600',
            colors: [
                { name: 'blue', classes: 'bg-blue-500 hover:bg-blue-600' },
                { name: 'green', classes: 'bg-green-500 hover:bg-green-600' },
                { name: 'purple', classes: 'bg-purple-500 hover:bg-purple-600' }
            ]
        };

        let appState = {
            currentUser: '', 
            playerID: '',
            currentQuiz: [],
            quizTopic: '',
            originalQuizOrder: [],
            shuffledQuizMap: [],
            shuffledOptionsMap: [],
            currentQuestionIndex: 0,
            score: 0,
            isShuffled: false,
            userAnswers: [],
            currentModalHistory: null,
            isQuizStarted: false,
            quizStartTime: null,
            currentScreen: null, 
            lastScreen: null,
            isPopping: false
        };

        const APEX_LIB_KEY = 'apexChartsLibraryCode_v2';
        const APEX_CDN_URL = 'https://cdn.jsdelivr.net/npm/apexcharts';
        
        const DOCX_LIB_KEY = 'docxLibraryCode_v8.5.0';
        const DOCX_CDN_URL = 'https://unpkg.com/docx@8.5.0/build/index.js';

        function injectScript(scriptText, callback) {
            const scriptElement = document.createElement('script');
            scriptElement.textContent = scriptText;
            document.head.appendChild(scriptElement);
            setTimeout(callback, 100); 
        }

        async function ensureLibraryIsLoaded(libKey, cdnUrl, checkVar, callback) {
             if (typeof window[checkVar] !== 'undefined') {
                callback();
                return;
            }

            const cachedScript = localStorage.getItem(libKey);
            if (cachedScript) {
                injectScript(cachedScript, callback);
            } else {
                try {
                    const response = await fetch(cdnUrl);
                    if (!response.ok) throw new Error(`Network response was not ok: ${response.status}`);
                    const scriptText = await response.text();
                    
                    try {
                        localStorage.setItem(libKey, scriptText);
                    } catch (e) {
                        console.warn(`Could not cache ${checkVar} library: ${e.message}`);
                    }
                    
                    injectScript(scriptText, callback);
                } catch (error) {
                    console.error(`Failed to fetch ${checkVar}:`, error);
                    alert(`Táº£i thÆ° viá»‡n ${checkVar} tháº¥t báº¡i. Vui lÃ²ng kiá»ƒm tra káº¿t ná»‘i Internet vÃ  thá»­ láº¡i.`);
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            initIndexedDB();
            checkLogin();
            initComparisonMenuListeners(); 
            initHelpModalListeners();
            syncResultsWithFirebase();
        });

        function checkLogin() {
            const savedUser = localStorage.getItem('quizAppUser');
            const savedPlayerID = localStorage.getItem('quizAppPlayerID');
            if (savedUser && savedPlayerID) {
                appState.currentUser = savedUser;
                appState.playerID = savedPlayerID;
                document.getElementById('user-greeting').textContent = `Xin chÃ o, ${appState.currentUser}!`;
                showScreen('home-screen');
            } else {
                showScreen('login-screen');
            }
        }

        function initHelpModalListeners() {
            document.getElementById('comparison-help-btn').addEventListener('click', () => {
                document.getElementById('helpModal').style.display = 'block';
            });
        }
        
        function initEventListeners() {
            window.addEventListener('online', syncResultsWithFirebase);
            document.getElementById('login-btn').addEventListener('click', () => {
                const username = document.getElementById('username-input').value.trim();
                if (username) {
                    appState.currentUser = username;
                    localStorage.setItem('quizAppUser', username);

                    let playerID = localStorage.getItem('quizAppPlayerID');
                    if (!playerID) {
                        playerID = `${username.replace(/\s/g, '')}-${Date.now()}`;
                        localStorage.setItem('quizAppPlayerID', playerID);
                    }
                    appState.playerID = playerID;
                    
                    document.getElementById('user-greeting').textContent = `Xin chÃ o, ${appState.currentUser}!`;
                    showScreen('home-screen');
                } else {
                    alert('Vui lÃ²ng nháº­p tÃªn cá»§a báº¡n.');
                }
            });

            document.getElementById('start-btn').addEventListener('click', startQuiz);
            document.getElementById('shuffle-btn').addEventListener('click', toggleShuffle);
            document.getElementById('submit-early-btn').addEventListener('click', submitEarly);
            document.getElementById('deleteHistoryBtn').addEventListener('click', deleteHistoryFromModal);
            
            document.getElementById('menu-shuffle-btn').addEventListener('click', toggleShuffle);
            document.getElementById('menu-start-btn').addEventListener('click', startQuizFromMenu);

            let startX = 0;
            document.addEventListener("touchstart", (e) => {
                startX = e.touches[0].clientX;
            });
            document.addEventListener("touchend", (e) => {
                const endX = e.changedTouches[0].clientX;
                const diff = endX - startX;
                const activeScreen = document.querySelector('.screen.active');
                if (!activeScreen) return;
                
                if (activeScreen.id === 'history-list-screen') {
                    if (diff < -50 && historySidebarVisible) toggleHistorySidebar(false);
                    if (diff > 50 && !historySidebarVisible) toggleHistorySidebar(true);
                }
            });
            window.onpopstate = handlePopState;
        }

        function showScreen(screenId) {
            if (appState.currentScreen === screenId) return;

            // <-- THÃŠM Má»šI: Dá»«ng nháº¡c ná»n khi thoÃ¡t khá»i mÃ n hÃ¬nh quiz
            if (appState.currentScreen === 'quiz-section' && screenId !== 'quiz-section') {
                backgroundMusic.pause();
                backgroundMusic.currentTime = 0;
            }

            if (appState.currentScreen === 'history-list-screen') {
                closeHistoryModal();
                closeComparisonModal();
                const statsModal = document.getElementById('statisticsModal');
                if (statsModal) statsModal.style.display = 'none';
            }

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            
            const targetScreenElement = document.getElementById(screenId);
            if (targetScreenElement) {
                 targetScreenElement.classList.add('active');
            } else {
                console.error(`Lá»—i: KhÃ´ng tÃ¬m tháº¥y mÃ n hÃ¬nh vá»›i ID: ${screenId}`);
                document.getElementById('login-screen').classList.add('active');
                screenId = 'login-screen';
            }
           
            appState.lastScreen = appState.currentScreen;
            appState.currentScreen = screenId;

            if (screenId === 'home-screen') {
                appState.currentQuiz = [];
                appState.isQuizStarted = false;
                appState.userAnswers = [];
                appState.score = 0;
                appState.currentQuestionIndex = 0;
            } else if (screenId === 'history-list-screen') {
                renderHistoryList();
                toggleHistorySidebar(true);
            }
            
            if (!appState.isPopping && history.state?.screen !== screenId) {
                history.pushState({ screen: screenId }, '');
            }
        }
        function handlePopState(event) {
            appState.isPopping = true;
            if (appState.isQuizStarted) {
                if (confirm('Báº¡n cÃ³ muá»‘n quay láº¡i khÃ´ng? Náº¿u cÃ³ sáº½ coi nhÆ° ná»™p bÃ i sá»›m.')) {
                    showResults();
                    showScreen('home-screen');
                    history.replaceState({ screen: 'home-screen' }, '');
                } else {
                    history.pushState({ screen: 'quiz-section' }, '');
                }
            } else {
                const targetScreen = event.state && event.state.screen ? event.state.screen : 'login-screen';
                showScreen(targetScreen);
            }
            appState.isPopping = false;
        }
        
        function prepareQuizUI(questions, doShowScreen = true, topic = 'BÃ i thi') {
            appState.quizTopic = topic;
            appState.currentQuiz = questions;
            appState.originalQuizOrder = [...questions];
            if (doShowScreen) {
                showScreen('quiz-section');
            }
            document.getElementById('quiz-title').textContent = topic;
            document.getElementById('quiz-live-container').innerHTML = '';
            document.getElementById('results-container').style.display = 'none';
            const startBtn = document.getElementById('start-btn');
            startBtn.style.display = 'inline-block';
            startBtn.textContent = 'Báº¯t Äáº§u';
            const shuffleBtn = document.getElementById('shuffle-btn');
            shuffleBtn.style.display = 'inline-block';
            shuffleBtn.textContent = `Trá»™n cÃ¢u há»i vÃ  Ä‘Ã¡p Ã¡n: ${appState.isShuffled ? 'Báº­t' : 'Táº¯t'}`;
            document.getElementById('submit-early-btn').style.display = 'none';
        }

        function startQuizFromMenu() {
            if (EMBEDDED_QUIZ_DATA.length === 0) {
                alert("ChÆ°a cÃ³ dá»¯ liá»‡u bÃ i thi. Vui lÃ²ng thÃªm cÃ¢u há»i vÃ o biáº¿n EMBEDDED_QUIZ_DATA.");
                return;
            }
            prepareQuizUI(EMBEDDED_QUIZ_DATA, true, "BÃ i kiá»ƒm tra tá»•ng há»£p");
            startQuiz();
        }

        function startQuiz() {
            appState.score = 0;
            appState.currentQuestionIndex = 0;
            appState.userAnswers = [];
            appState.isQuizStarted = true;
            appState.quizStartTime = Date.now();
            appState.shuffledQuizMap = [];
            appState.shuffledOptionsMap = [];
            if (appState.isShuffled) {
                let indices = Array.from({length: appState.currentQuiz.length}, (_, i) => i);
                indices.sort(() => Math.random() - 0.5);
                appState.shuffledQuizMap = indices;
                appState.currentQuiz = indices.map(i => ({...appState.originalQuizOrder[i]}));
            } else {
                appState.currentQuiz = [...appState.originalQuizOrder];
            }
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('shuffle-btn').style.display = 'none';
            document.getElementById('submit-early-btn').style.display = 'inline-block';
            
            // <-- THÃŠM Má»šI: Báº­t nháº¡c ná»n
            backgroundMusic.currentTime = 0;
            backgroundMusic.play();

            displayQuestion();
        }

        function displayQuestion() {
            const container = document.getElementById('quiz-live-container');
            if (appState.currentQuestionIndex >= appState.currentQuiz.length) {
                showResults();
                return;
            }
            const q = appState.currentQuiz[appState.currentQuestionIndex];
            let optionsToDisplay = [...q.lua_chon];

            if (appState.isShuffled && (q.type === 'multiple_choice' || q.type === 'multiple_answer')) {
                 if (q.hasLineMarker) {
                    let optionObjects = q.lua_chon.map((opt, index) => ({ text: opt, originalIndex: index }));
                    optionObjects.sort(() => Math.random() - 0.5);
                    optionsToDisplay = optionObjects.map(obj => obj.text);
                    appState.shuffledOptionsMap[appState.currentQuestionIndex] = optionObjects.map(obj => obj.originalIndex);
                 } else {
                    const originalLabels = q.lua_chon.map(opt => (opt.match(optionPrefixRegex) || [''])[0]);
                    const originalContents = q.lua_chon.map(opt => opt.replace(optionPrefixRegex, '').replace(/^\*/, '').trim());
                    let contentIndices = Array.from({ length: originalContents.length }, (_, i) => i);
                    contentIndices.sort(() => Math.random() - 0.5);
                    appState.shuffledOptionsMap[appState.currentQuestionIndex] = contentIndices;
                    optionsToDisplay = originalLabels.map((label, index) => {
                        const shuffledContentIndex = contentIndices[index];
                        const originalOptionWithStar = q.lua_chon.find(opt => opt.replace(optionPrefixRegex, '').replace(/^\*/, '').trim() === originalContents[shuffledContentIndex]);
                        return originalOptionWithStar || (label + originalContents[shuffledContentIndex]);
                    });
                 }
            }

            let questionHTML = `<div class="question-container" id="q-${appState.currentQuestionIndex}">
                <p class="question-text">CÃ¢u ${appState.currentQuestionIndex + 1}: ${q.cau_hoi ? q.cau_hoi.replace(/\n/g, '<br>') : 'Ná»™i dung khÃ´ng xÃ¡c Ä‘á»‹nh'}</p>
                <div class="options-container">`;
            
            const createOptionHTML = (type, value) => {
                const cleanText = value.replace(/^\*/, '').trim();
                return `<label><input type="${type}" name="option-${appState.currentQuestionIndex}" value="${escapeHtml(value)}" class="mr-2"> ${escapeHtml(cleanText)}</label>`;
            };
            
            if (q.type === 'multiple_choice') {
                optionsToDisplay.forEach(c => questionHTML += createOptionHTML('radio', c));
            } else if (q.type === 'multiple_answer') {
                 optionsToDisplay.forEach(c => questionHTML += createOptionHTML('checkbox', c));
            } else {
                questionHTML += `<input type="text" id="short-answer-input-${appState.currentQuestionIndex}" placeholder="Nháº­p cÃ¢u tráº£ lá»i..." style="width:100%; padding:10px; font-size:16px;">`;
            }
            
            questionHTML += `</div><div class="feedback"></div>
                             <button class="btn" style="margin-top:15px;" onclick="checkAnswer()">Tráº£ Lá»i</button>
                             </div>`;
            container.innerHTML = questionHTML;
        }

        function checkAnswer() {
            const q = appState.currentQuiz[appState.currentQuestionIndex];
            const container = document.getElementById(`q-${appState.currentQuestionIndex}`);
            const inputs = container.querySelectorAll('input');
            const feedbackDiv = container.querySelector('.feedback');

            const getCleanContent = (text) => {
                if (!text) return '';
                return text.replace(optionPrefixRegex, '').replace(/^\*/, '').trim();
            };

            let isCorrect = false;
            let selected = [];
            inputs.forEach(input => input.disabled = true);
            
            const cleanCorrectAnswers = q.dap_an_dung.map(ans => getCleanContent(ans));

            if (q.type === 'multiple_choice') {
                const sel = container.querySelector(`input[type="radio"]:checked`);
                if (sel) {
                    selected = [sel.value];
                    const cleanSelectedContent = getCleanContent(selected[0]);
                    isCorrect = cleanCorrectAnswers.includes(cleanSelectedContent);
                }
            } else if (q.type === 'multiple_answer') {
                selected = Array.from(container.querySelectorAll(`input[type="checkbox"]:checked`)).map(el => el.value);
                const cleanSelectedContents = selected.map(s => getCleanContent(s));
                isCorrect = cleanSelectedContents.length === cleanCorrectAnswers.length && cleanSelectedContents.every(s => cleanCorrectAnswers.includes(s));
            } else { 
                const userAnswer = container.querySelector(`#short-answer-input-${appState.currentQuestionIndex}`).value.trim();
                selected = [userAnswer];
                isCorrect = q.dap_an_dung.some(ans => ans.toLowerCase() === userAnswer.toLowerCase());
            }

            appState.userAnswers.push({ questionIndex: appState.currentQuestionIndex, selected, isCorrect });

            if (isCorrect) {
                appState.score++;
                correctAnswerSound.play(); // <-- THÃŠM Má»šI: Ã‚m thanh tráº£ lá»i Ä‘Ãºng
            } else {
                incorrectAnswerSound.play(); // <-- THÃŠM Má»šI: Ã‚m thanh tráº£ lá»i sai
            }

            feedbackDiv.textContent = `${isCorrect ? 'ÄÃºng' : 'Sai'}`;
            if (!isCorrect) {
                feedbackDiv.textContent += ` - ÄÃ¡p Ã¡n Ä‘Ãºng: ${q.dap_an_dung.join(', ')}`;
            }

            container.querySelectorAll('label').forEach(label => {
                const input = label.querySelector('input');
                if (input) {
                    const isAnswerKey = q.dap_an_dung.some(correct_ans => getCleanContent(correct_ans) === getCleanContent(input.value));
                    if (isAnswerKey) {
                        label.style.backgroundColor = '#d4edda';
                    } else if (input.checked) {
                        label.style.backgroundColor = '#f8d7da';
                    }
                }
            });

            const button = container.querySelector('button');
            button.textContent = 'CÃ¢u Tiáº¿p Theo';
            button.onclick = nextQuestion;
        }

        function nextQuestion() {
            appState.currentQuestionIndex++;
            displayQuestion();
        }
        function submitEarly() {
            if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n ná»™p bÃ i sá»›m khÃ´ng? CÃ¡c cÃ¢u chÆ°a lÃ m sáº½ coi nhÆ° sai.')) {
                showResults();
            }
        }
        function showResults() {
            appState.isQuizStarted = false;
            const durationInMs = Date.now() - appState.quizStartTime;
            document.getElementById('quiz-live-container').innerHTML = '';
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.style.display = 'block';
            const total = appState.currentQuiz.length;
            document.getElementById('final-score').textContent = `Báº¡n Ä‘Ã£ Ä‘Ãºng ${appState.score} / ${total} cÃ¢u!`;
            
            // <-- THÃŠM Má»šI: Dá»«ng nháº¡c ná»n
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;

            saveHistory(appState.userAnswers, appState.score, total, durationInMs)
                .then(() => {
                    syncResultsWithFirebase();
                });

            document.getElementById('start-btn').textContent = 'LÃ m Láº¡i';
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('shuffle-btn').style.display = 'inline-block';
            document.getElementById('submit-early-btn').style.display = 'none';
        }
        function toggleShuffle() {
            appState.isShuffled = !appState.isShuffled;
            const shuffleText = `Trá»™n cÃ¢u há»i vÃ  Ä‘Ã¡p Ã¡n: ${appState.isShuffled ? 'Báº­t' : 'Táº¯t'}`;
            document.getElementById('shuffle-btn').textContent = shuffleText;
            document.getElementById('menu-shuffle-btn').textContent = shuffleText;
        }
        let db;
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                if (db) return resolve(true);
                const request = indexedDB.open('QuizAppDB', 2);
                request.onupgradeneeded = function(event) {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('quizStore')) {
                        db.createObjectStore('quizStore', { keyPath: 'id' });
                    }
                };
                request.onsuccess = function(event) {
                    db = event.target.result;
                    resolve(true);
                };
                request.onerror = function(event) {
                    console.error("Lá»—i má»Ÿ IndexedDB: ", event);
                    reject(false);
                };
            });
        }
        async function saveToStorage(key, value) {
            try {
                const compressed = LZString.compress(JSON.stringify(value));
                localStorage.setItem(key, compressed);
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    console.warn(`LocalStorage quota exceeded for key ${key}. Trying IndexedDB.`);
                    try {
                        const compressed = LZString.compress(JSON.stringify(value));
                        await initIndexedDB();
                        const transaction = db.transaction(['quizStore'], 'readwrite');
                        const store = transaction.objectStore('quizStore');
                        store.put({ id: key, data: compressed });
                    } catch (dbError) {
                        console.error(`Failed to save ${key} to IndexedDB:`, dbError);
                        alert('KhÃ´ng thá»ƒ lÆ°u dá»¯ liá»‡u. Bá»™ nhá»› Ä‘Ã£ Ä‘áº§y.');
                    }
                } else {
                    console.error("Lá»—i lÆ°u vÃ o localStorage:", e);
                    alert('ÄÃ£ xáº£y ra lá»—i khi lÆ°u dá»¯ liá»‡u.');
                }
            }
        }

        async function getFromStorage(key) {
            try {
                const localData = localStorage.getItem(key);
                if (localData) {
                    const decompressed = LZString.decompress(localData);
                    if (decompressed) {
                        return JSON.parse(decompressed);
                    }
                    return null;
                }
            } catch (e) {
                console.error(`[Lá»—i] KhÃ´ng thá»ƒ phÃ¢n tÃ­ch dá»¯ liá»‡u localStorage cho key '${key}'. Dá»¯ liá»‡u cÃ³ thá»ƒ bá»‹ há»ng. Lá»—i:`, e);
            }
            
            try {
                await initIndexedDB();
                return new Promise((resolve) => {
                    const transaction = db.transaction(['quizStore'], 'readonly');
                    const store = transaction.objectStore('quizStore');
                    const request = store.get(key);

                    request.onsuccess = () => {
                        if (!request.result || !request.result.data) {
                            return resolve(null);
                        }
                        try {
                            const decompressed = LZString.decompress(request.result.data);
                            const result = decompressed ? JSON.parse(decompressed) : null;
                            resolve(result);
                        } catch (e) {
                            console.error(`[Lá»—i] KhÃ´ng thá»ƒ phÃ¢n tÃ­ch dá»¯ liá»‡u IndexedDB cho key '${key}'. Dá»¯ liá»‡u cÃ³ thá»ƒ bá»‹ há»ng. Lá»—i:`, e);
                            resolve(null);
                        }
                    };
                    request.onerror = () => {
                        console.error(`Lá»—i khi láº¥y '${key}' tá»« IndexedDB.`);
                        resolve(null);
                    };
                });
            } catch (dbError) {
                console.error(`KhÃ´ng thá»ƒ láº¥y '${key}' tá»« IndexedDB:`, dbError);
                return null;
            }
        }
        
        const historySidebar = document.getElementById('history-sidebar');
        const historyMainContent = document.getElementById('history-mainContent');
        let historySidebarVisible = true;
        function toggleHistorySidebar(show) {
            historySidebarVisible = show;
            if (show) {
                historySidebar.style.transform = "translateX(0)";
                historyMainContent.classList.remove("full");
                historyMainContent.classList.add("with-sidebar");
            } else {
                historySidebar.style.transform = "translateX(-100%)";
                historyMainContent.classList.remove("with-sidebar");
                historyMainContent.classList.add("full");
            }
        }
        
        async function saveHistory(answers, score, total, durationInMs) {
            let history = await getFromStorage('quizHistory') || [];
            if (!Array.isArray(history)) history = [];
            const entry = {
                id: Date.now(),
                user: appState.currentUser,
                playerID: appState.playerID,
                quizTopic: appState.quizTopic,
                quiz: appState.originalQuizOrder,
                shuffledQuizMap: appState.shuffledQuizMap,
                shuffledOptionsMap: appState.shuffledOptionsMap,
                answers,
                score,
                total,
                durationInMs,
                isShuffled: appState.isShuffled,
                date: new Date().toLocaleString('vi-VN'),
                isSyncedWithFirebase: false
            };
            history.unshift(entry);
            if (history.length > 50) history.pop();
            await saveToStorage('quizHistory', history);
        }

        async function renderHistoryList() {
            const container = document.getElementById('history-list');
            container.innerHTML = '';
            const history = await getFromStorage('quizHistory') || [];
             if (!Array.isArray(history)) {
                container.innerHTML = '<p class="text-red-500 p-2">Lá»—i Ä‘á»c dá»¯ liá»‡u lá»‹ch sá»­.</p>';
                return;
            }
            if (history.length === 0) {
                container.innerHTML = '<p class="text-gray-500 p-2">ChÆ°a cÃ³ lá»‹ch sá»­ lÃ m bÃ i.</p>';
                return;
            }
            history.forEach((entry, index) => {
                if (!entry || typeof entry.date === 'undefined' || typeof entry.score === 'undefined') {
                    console.error('Bá» qua má»¥c lá»‹ch sá»­ bá»‹ lá»—i:', entry);
                    return;
                }
                const colorInfo = pillColorConfig.colors[index % pillColorConfig.colors.length];
                const btn = document.createElement('button');
                btn.dataset.id = entry.id;
                btn.dataset.color = colorInfo.name;
                const userDisplay = entry.user ? `[${entry.user}] ` : '';
                btn.textContent = `${userDisplay}${entry.date} (${entry.score}/${entry.total})`;
                btn.className = `${pillColorConfig.baseClasses} ${colorInfo.classes}`;
                
                btn.onclick = () => {
                    const wasSelected = btn.classList.contains('bg-gray-500');

                    container.querySelectorAll('button').forEach(b => {
                        const originalColorName = b.dataset.color;
                        const originalColorInfo = pillColorConfig.colors.find(c => c.name === originalColorName);
                        if(originalColorInfo) {
                           b.className = `${pillColorConfig.baseClasses} ${originalColorInfo.classes}`;
                        }
                    });

                    const questionBox = document.getElementById('history-questionBox');
                    questionBox.innerHTML = '';
                    questionBox.classList.add("hidden");

                    if (!wasSelected) {
                        btn.className = `${pillColorConfig.baseClasses} ${pillColorConfig.selectedClasses}`;

                        const div = document.createElement("div");
                        div.className = "p-3 border rounded bg-gray-50";
                        const userTitle = entry.user ? `cá»§a ${entry.user} ` : '';
                        let content = `<p class="font-bold">Káº¿t quáº£ ${userTitle}ngÃ y ${entry.date} (Äiá»ƒm: ${entry.score}/${entry.total})</p>
                                       <button class="btn text-sm p-2 mt-2" onclick="showHistoryContent('${entry.id}')">Xem Chi Tiáº¿t</button>`;
                        if (entry.isShuffled) {
                            content += `<button class="btn text-sm p-2 mt-2 ml-2" onclick="showComparison(${entry.id})">Xem so sÃ¡nh</button>`;
                        }
                        content += `<button class="btn btn-warning text-sm p-2 mt-2 ml-2" onclick="showStatistics(${entry.id})">Thá»‘ng kÃª</button>`;
                        div.innerHTML = content;
                        questionBox.appendChild(div);
                        questionBox.classList.remove("hidden");
                    }
                };
                container.appendChild(btn);
            });
        }
        
        async function showHistoryContent(hid) {
            const history = await getFromStorage('quizHistory') || [];
            const entry = history.find(e => e.id == hid);
            if (!entry) return;
            appState.currentModalHistory = entry;
            const modal = document.getElementById('history-contentModal');
            const modalTitle = document.getElementById('history-modalTitle');
            const modalContent = document.getElementById('history-modalContent');
            
            const userTitle = entry.user ? `cá»§a ${entry.user} ` : '';
            modalTitle.textContent = `Lá»‹ch sá»­ lÃ m bÃ i ${userTitle}: ${entry.date}`;
            modalContent.innerHTML = `<h4>Äiá»ƒm: ${entry.score}/${entry.total}</h4>`;
            
            const quizData = entry.isShuffled ? entry.shuffledQuizMap.map(i => entry.quiz[i]) : entry.quiz;
            
            quizData.forEach((q, index) => {
                const userAnswerEntry = entry.answers.find(a => a.questionIndex === index) || { selected: [], isCorrect: false };
                let contentHTML = `<div style="margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #eee;"><p><strong>CÃ¢u ${index + 1}:</strong> ${q.cau_hoi ? q.cau_hoi.replace(/\n/g, '<br>') : 'Ná»™i dung khÃ´ng xÃ¡c Ä‘á»‹nh'}</p>`;
                
                const originalQuestionIndex = entry.isShuffled ? entry.shuffledQuizMap[index] : index;
                const correctAnswers = entry.quiz[originalQuestionIndex].dap_an_dung;

                if (q.lua_chon && q.lua_chon.length > 0) {
                     const getCleanContent = (text) => {
                        if (!text) return '';
                        return text.replace(optionPrefixRegex, '').replace(/^\*/, '').trim();
                    };

                    contentHTML += '<ul>' + q.lua_chon.map(c => {
                        const isAnswerKey = correctAnswers.some(ans => getCleanContent(ans) === getCleanContent(c));
                        const isSelected = userAnswerEntry.selected.some(sel => getCleanContent(sel) === getCleanContent(c));
                        
                        let style = '';
                        if (isSelected) {
                            style = isAnswerKey 
                                ? 'color: var(--success-color); font-weight: bold;'
                                : 'color: var(--danger-color);';
                        } else if (isAnswerKey) {
                            style = 'color: var(--success-color); text-decoration: underline;';
                        }
                        
                        return `<li style="${style}">${c}</li>`;
                    }).join('') + '</ul>';
                }

                contentHTML += `<p>CÃ¢u tráº£ lá»i cá»§a báº¡n: <strong>${userAnswerEntry.selected.join(', ') || 'ChÆ°a tráº£ lá»i'}</strong> - <strong style="color:${userAnswerEntry.isCorrect ? 'var(--success-color)' : 'var(--danger-color)'};">${userAnswerEntry.isCorrect ? 'ÄÃºng' : 'Sai'}</strong></p>`;
                if (!userAnswerEntry.isCorrect) {
                     contentHTML += `<p style="color: var(--success-color);"><em>ÄÃ¡p Ã¡n Ä‘Ãºng: ${correctAnswers.join(', ')}</em></p>`;
                }
                modalContent.innerHTML += contentHTML + '</div>';
            });
            document.getElementById('deleteHistoryBtn').onclick = () => deleteHistory(hid);
            modal.style.display = 'block';
        }
        
        function showStatistics(hid) {
            ensureLibraryIsLoaded('apexChartsLibraryCode_v2', 'https://cdn.jsdelivr.net/npm/apexcharts', 'ApexCharts', async () => {
                try {
                    const history = await getFromStorage('quizHistory') || [];
                    const entry = history.find(e => e.id == hid);
                    if (!entry) {
                        alert("Lá»—i: KhÃ´ng tÃ¬m tháº¥y lá»‹ch sá»­ lÃ m bÃ i.");
                        return;
                    }
                
                    const modal = document.getElementById('statisticsModal');
                    const modalTitle = document.getElementById('statistics-modalTitle');
                    const legendContent = document.getElementById('statistics-legend');
                    
                    const correctCount = entry.score;
                    const answeredCount = entry.answers.length;
                    const incorrectCount = answeredCount - correctCount;
                    const unansweredCount = entry.total - answeredCount;
                    const correctPercentage = entry.total > 0 ? ((correctCount / entry.total) * 100).toFixed(1) : 0;
                    
                    const quizSignature = JSON.stringify(entry.quiz.map(q => q.cau_hoi).sort());
                    const quizAttempts = history.filter(h => JSON.stringify(h.quiz.map(q => q.cau_hoi).sort()) === quizSignature).length;
                    
                    const userTitle = entry.user ? `cá»§a ${entry.user} ` : '';
                    modalTitle.textContent = `Thá»‘ng kÃª ${userTitle}: ${entry.date}`;
                
                    legendContent.innerHTML = `
                        <p><strong>Káº¿t quáº£:</strong> 
                            <span style="color:var(--success-color)">${correctCount} ÄÃºng</span> / 
                            <span style="color:var(--danger-color)">${incorrectCount} Sai</span> / 
                            <span style="color:var(--secondary-color)">${unansweredCount} ChÆ°a lÃ m</span>
                            (trÃªn tá»•ng ${entry.total} cÃ¢u).
                        </p>
                        <p><strong>Tá»‰ lá»‡ Ä‘Ãºng:</strong> ${correctPercentage}%</p>
                        <p><strong>Sá»‘ láº§n lÃ m bÃ i nÃ y (tá»•ng cá»™ng):</strong> ${quizAttempts}</p>
                    `;
                    
                    const chartEl = document.querySelector("#statistics-chart");
                    if(window.statisticsChart) {
                        window.statisticsChart.destroy();
                    }

                    const seriesData = [correctCount, incorrectCount, unansweredCount];
                    const labelsData = ['ÄÃºng', 'Sai', 'ChÆ°a lÃ m'];
                    const colorsData = [
                        getComputedStyle(document.documentElement).getPropertyValue('--success-color').trim(), 
                        getComputedStyle(document.documentElement).getPropertyValue('--danger-color').trim(),
                        getComputedStyle(document.documentElement).getPropertyValue('--secondary-color').trim()
                    ];

                    const options = {
                        chart: { type: 'pie', height: 320, animations: { enabled: true } },
                        series: seriesData,
                        labels: labelsData,
                        colors: colorsData,
                        legend: { position: 'bottom' },
                        tooltip: { y: { formatter: (val) => val + " cÃ¢u" } },
                        dataLabels: {
                            formatter: (val, opts) => {
                                 const total = opts.w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                if (opts.w.globals.series[opts.seriesIndex] === 0 || total === 0) return '';
                                const percent = ((opts.w.globals.series[opts.seriesIndex] / total) * 100).toFixed(0) + '%';
                                return percent;
                            },
                            style: { colors: ['#fff'] },
                            dropShadow: { enabled: true, top: 1, left: 1, blur: 1, opacity: 0.5 }
                        }
                    };
                    
                    if (correctCount === 0 && incorrectCount === 0 && unansweredCount === 0) {
                        options.series = [1];
                        options.labels = ['ChÆ°a cÃ³ dá»¯ liá»‡u'];
                        options.colors = ['#B0B0B0'];
                    }

                    window.statisticsChart = new ApexCharts(chartEl, options);
                    window.statisticsChart.render();
                    
                    modal.style.display = 'block';
                
                    document.getElementById('statistics-close-btn').onclick = () => {
                        modal.style.display = 'none';
                    };
                } catch (e) {
                    console.error("Error in showStatistics:", e);
                    alert("ÄÃ£ xáº£y ra lá»—i khi hiá»ƒn thá»‹ thá»‘ng kÃª: " + e.message);
                }
            });
        }
        
        let largeSearchMatches = [];
        let currentMatchIndex = -1;

        async function showComparison(hid) {
            const history = await getFromStorage('quizHistory') || [];
            const entry = history.find(e => e.id == hid);
            if (!entry || !entry.isShuffled) {
                alert("Lá»—i: KhÃ´ng tÃ¬m tháº¥y lá»‹ch sá»­ hoáº·c Ä‘Ã¢y khÃ´ng pháº£i lÃ  bÃ i thi Ä‘Ã£ Ä‘Æ°á»£c xÃ¡o trá»™n.");
                return;
            }

            const modal = document.getElementById('comparisonModal');
            const modalTitle = document.getElementById('comparison-modalTitle');
            const comparisonContainer = document.getElementById('comparison-content');
            
            const fragment = document.createDocumentFragment();
            const lightColors = ['#D4EDDA', '#FFF3CD', '#D1ECF1', '#F8D7DA', '#E2E3E5', '#CCE5FF'];

            entry.shuffledQuizMap.forEach((originalIndex, shuffledIndex) => {
                const originalQ = entry.quiz[originalIndex];
                const userAnswerEntry = entry.answers.find(a => a.questionIndex === shuffledIndex);

                const questionBlock = document.createElement('div');
                questionBlock.className = 'comparison-question';
                questionBlock.id = `comp-q-shuffled-${shuffledIndex + 1}`;
                questionBlock.dataset.originalIndex = originalIndex + 1;
                
                let questionBlockHTML = `<h4 style="text-align:center; color: #0056b3; font-weight: bold;">CÃ¢u gá»‘c ${originalIndex + 1} &rArr; CÃ¢u xÃ¡o trá»™n ${shuffledIndex + 1}</h4>
                    <p class="comparison-question-text">${originalQ.cau_hoi.replace(/\n/g, '<br>')}</p>`;

                if (originalQ.type === 'short_answer') {
                    const correctAnswer = originalQ.dap_an_dung.join(', ');
                    let userAnswerHTML = '<em>(ChÆ°a tráº£ lá»i)</em>';
                    if (userAnswerEntry && userAnswerEntry.selected.length > 0 && userAnswerEntry.selected[0]) {
                        const userAnswer = userAnswerEntry.selected[0];
                        const userAnswerColor = userAnswerEntry.isCorrect ? 'var(--success-color)' : 'var(--danger-color)';
                        userAnswerHTML = `<strong style="color: ${userAnswerColor};">${userAnswer}</strong>`;
                    }
                    questionBlockHTML += `<div style="text-align:center; padding:10px; background-color:#f0f0f0; border-radius:8px;">
                                            <p>ÄÃ¡p Ã¡n Ä‘Ãºng: <strong style="color: var(--success-color);">${correctAnswer}</strong></p>
                                            <p>Báº¡n Ä‘Ã£ tráº£ lá»i: ${userAnswerHTML}</p>
                                         </div>`;
                } else {
                    questionBlockHTML += `<div class="options-comparison-wrapper">`;
                    
                    questionBlockHTML += `<div class="options-column"><h5>Äá» gá»‘c</h5>`;
                    originalQ.lua_chon.forEach((opt, idx) => {
                        const isCorrect = originalQ.dap_an_dung.includes(opt);
                        const style = isCorrect ? 'color: var(--success-color); font-weight: bold;' : 'color: var(--text-color);';
                        const color = lightColors[idx % lightColors.length];
                        questionBlockHTML += `<div class="option-item" style="background-color: ${color};"><span style="${style}">${opt}</span></div>`;
                    });
                    questionBlockHTML += `</div>`;
                    
                    questionBlockHTML += `<div class="options-column"><h5>Báº¡n lÃ m</h5>`;
                    const shuffledContentIndices = entry.shuffledOptionsMap[shuffledIndex] || [];
                    const userSelectedOptions = userAnswerEntry ? userAnswerEntry.selected : [];

                    if (Array.isArray(originalQ.lua_chon) && originalQ.lua_chon.length > 0) {
                        const getCleanContent = (text) => {
                           if (!text) return '';
                           if(originalQ.hasLineMarker) return text.replace(/^\*/, '').trim();
                           return text.replace(optionPrefixRegex, '').replace(/\*/g, '').trim();
                        };
                        
                         if (originalQ.hasLineMarker) {
                             const originalOptionObjects = originalQ.lua_chon.map((opt, index) => ({ text: opt, originalIndex: index }));
                             const shuffledOriginalIndices = shuffledContentIndices.length > 0 ? shuffledContentIndices : originalOptionObjects.map(o => o.originalIndex);
                             
                             shuffledOriginalIndices.forEach(originalContentIndex => {
                                 const originalOptionString = originalOptionObjects[originalContentIndex].text;
                                 const isThisOptionCorrect = originalQ.dap_an_dung.includes(originalOptionString);
                                 const wasThisOptionSelected = userSelectedOptions.includes(originalOptionString);
                                 const color = lightColors[originalContentIndex % lightColors.length];
                                 
                                 let finalStyle = '';
                                 if (wasThisOptionSelected) {
                                     finalStyle = isThisOptionCorrect ? 'color: var(--success-color); font-weight: bold;' : 'color: var(--danger-color);';
                                 } else if (isThisOptionCorrect) {
                                     finalStyle = 'color: var(--success-color); text-decoration: underline;';
                                 } else {
                                     finalStyle = 'color: var(--text-color);';
                                 }
                                 
                                 questionBlockHTML += `<div class="option-item" style="background-color: ${color};"><span style="${finalStyle}">${originalOptionString}</span></div>`;
                             });
                         } else {
                            if (shuffledContentIndices.length > 0) {
                                const originalLabels = originalQ.lua_chon.map(opt => (opt.match(optionPrefixRegex) || [''])[0]);
                                const originalContents = originalQ.lua_chon.map(opt => getCleanContent(opt));

                                originalLabels.forEach((label, newIndex) => {
                                    const originalContentIndex = shuffledContentIndices[newIndex];
                                    if (originalContentIndex === undefined) return;

                                    const originalOptionString = originalQ.lua_chon[originalContentIndex];
                                    const fullShuffledOption = label + originalContents[originalContentIndex];
                                    
                                    const isThisOptionCorrect = originalQ.dap_an_dung.includes(originalOptionString);
                                    const wasThisOptionSelected = userSelectedOptions.includes(fullShuffledOption);
                                    const color = lightColors[originalContentIndex % lightColors.length];
                                    
                                    let finalStyle = '';
                                    if (wasThisOptionSelected) {
                                        finalStyle = isThisOptionCorrect ? 'color: var(--success-color); font-weight: bold;' : 'color: var(--danger-color);';
                                    } else if (isThisOptionCorrect) {
                                        finalStyle = 'color: var(--success-color); text-decoration: underline;';
                                    }
                                    
                                    questionBlockHTML += `<div class="option-item" style="background-color: ${color};"><span style="${finalStyle}">${fullShuffledOption}</span></div>`;
                                });
                            }
                        }
                    } else {
                         questionBlockHTML += `<p class="text-center text-gray-500 p-4">KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘Ã¡p Ã¡n cho cÃ¢u nÃ y.</p>`;
                    }
                    questionBlockHTML += `</div></div>`;
                }
                
                questionBlock.innerHTML = questionBlockHTML;
                fragment.appendChild(questionBlock);
            });

            comparisonContainer.innerHTML = '';
            comparisonContainer.appendChild(fragment);

            modalTitle.textContent = `So sÃ¡nh Ä‘á» gá»‘c vÃ  Ä‘á» Ä‘Ã£ xÃ¡o trá»™n: ${entry.date}`;
            modal.style.display = 'block';
            document.getElementById('comparison-menu-btn').style.display = 'flex';
            document.getElementById('comparison-help-btn').style.display = 'flex';
        }
        
        function closeComparisonModal() {
            document.getElementById('comparisonModal').style.display = 'none';
            document.getElementById('comparison-menu-btn').style.display = 'none';
            document.getElementById('comparison-help-btn').style.display = 'none'; 
            document.getElementById('helpModal').style.display = 'none'; 
            closeAllMenus();
            clearLargeSearch();
        }

        function initComparisonMenuListeners() {
            const menuBtn = document.getElementById('comparison-menu-btn');
            const smallMenu = document.getElementById('small-search-menu');
            const largeMenu = document.getElementById('large-search-menu');
            const modalContent = document.querySelector('#comparisonModal .modal-content');
            
            let pressTimer = null;
            let longPressTriggered = false;

            const startPress = (e) => {
                e.preventDefault();
                longPressTriggered = false;
                
                pressTimer = setTimeout(() => {
                    longPressTriggered = true;
                    closeAllMenus();
                    largeMenu.classList.add('open');
                    modalContent.classList.add('large-search-open');
                }, 500);
            };

            const endPress = (e) => {
                e.preventDefault();
                clearTimeout(pressTimer);

                if (longPressTriggered) {
                    return; 
                }

                if (largeMenu.classList.contains('open')) {
                    closeAllMenus();
                } else {
                    smallMenu.classList.toggle('open');
                }
            };
            
            menuBtn.addEventListener('mousedown', startPress);
            menuBtn.addEventListener('mouseup', endPress);
            menuBtn.addEventListener('mouseleave', () => {
                clearTimeout(pressTimer);
            });
            menuBtn.addEventListener('touchstart', startPress, { passive: false });
            menuBtn.addEventListener('touchend', endPress);

            document.getElementById('clear-small-search').addEventListener('click', () => {
                document.getElementById('dao-input').value = '';
                document.getElementById('thuan-input').value = '';
            });
            document.getElementById('exec-small-search').addEventListener('click', execSmallSearch);

            document.getElementById('clear-large-search').addEventListener('click', () => {
                document.getElementById('large-search-input').value = '';
                clearLargeSearch();
            });
            document.getElementById('exec-large-search').addEventListener('click', execLargeSearch);
            document.getElementById('prev-match-btn').addEventListener('click', () => navigateMatches(-1));
            document.getElementById('next-match-btn').addEventListener('click', () => navigateMatches(1));
        }
        
        function closeAllMenus() {
            document.getElementById('small-search-menu').classList.remove('open');
            const largeMenu = document.getElementById('large-search-menu');
            if (largeMenu.classList.contains('open')) {
                largeMenu.classList.remove('open');
                document.querySelector('#comparisonModal .modal-content').classList.remove('large-search-open');
            }
        }

        function execSmallSearch() {
            const daoInput = document.getElementById('dao-input');
            const thuanInput = document.getElementById('thuan-input');
            const daoValue = daoInput.value;
            const thuanValue = thuanInput.value;

            if (daoValue && thuanValue) {
                alert('Chá»‰ nháº­p 1 dÃ²ng thÃ´i!');
                return;
            }

            let targetElement = null;
            if (daoValue) {
                targetElement = document.getElementById(`comp-q-shuffled-${daoValue}`);
            } else if (thuanValue) {
                targetElement = document.querySelector(`.comparison-question[data-original-index='${thuanValue}']`);
            }

            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                targetElement.style.transition = 'background-color 0.5s';
                targetElement.style.backgroundColor = 'rgba(255, 255, 0, 0.3)';
                setTimeout(() => { targetElement.style.backgroundColor = ''; }, 1500);
            } else {
                if(daoValue || thuanValue) alert('CÃ¢u khÃ´ng tá»“n táº¡i!');
            }
        }

        function clearLargeSearch() {
            document.getElementById('large-search-results').textContent = '';
            document.getElementById('prev-match-btn').style.display = 'none';
            document.getElementById('next-match-btn').style.display = 'none';
            largeSearchMatches.forEach(match => {
                if (match.element) {
                   match.element.innerHTML = match.originalHTML;
                }
            });
            largeSearchMatches = [];
            currentMatchIndex = -1;
        }
        
        function execLargeSearch() {
            const searchText = document.getElementById('large-search-input').value.trim();
            const resultsDiv = document.getElementById('large-search-results');
            
            clearLargeSearch();
            
            if (searchText.length < 2) {
                resultsDiv.textContent = 'Vui lÃ²ng nháº­p Ã­t nháº¥t 2 kÃ½ tá»±.';
                return;
            }

            resultsDiv.textContent = 'Äang tÃ¬m kiáº¿m...';

            setTimeout(() => {
                const regex = new RegExp(searchText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'gi');
                const allQuestionBlocks = document.querySelectorAll('.comparison-question');
                let totalMatchCount = 0;

                allQuestionBlocks.forEach(qBlock => {
                    if (qBlock.textContent.toLowerCase().includes(searchText.toLowerCase())) {
                        const occurrences = (qBlock.textContent.match(regex) || []).length;
                        
                        if (occurrences > 0) {
                            totalMatchCount += occurrences;
                            const originalHTML = qBlock.innerHTML;
                            const newHTML = qBlock.innerHTML.replace(regex, (match) => `<mark>${match}</mark>`);
                            largeSearchMatches.push({ element: qBlock, originalHTML: originalHTML });
                            qBlock.innerHTML = newHTML;
                        }
                    }
                });
                
                if (largeSearchMatches.length > 0) {
                    resultsDiv.textContent = `TÃ¬m tháº¥y ${totalMatchCount} káº¿t quáº£ trong ${largeSearchMatches.length} cÃ¢u.`;
                    document.getElementById('prev-match-btn').style.display = 'inline-block';
                    document.getElementById('next-match-btn').style.display = 'inline-block';
                    currentMatchIndex = 0;
                    scrollToMatch(currentMatchIndex);
                } else {
                    resultsDiv.textContent = 'KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ nÃ o.';
                }
            }, 10);
        }
        
        function navigateMatches(direction) {
            if (largeSearchMatches.length === 0) return;
            const newIndex = currentMatchIndex + direction;
            if (newIndex >= 0 && newIndex < largeSearchMatches.length) {
                largeSearchMatches[currentMatchIndex].element.querySelector('mark')?.classList.remove('current-match');
                currentMatchIndex = newIndex;
                scrollToMatch(currentMatchIndex);
            }
        }

        function scrollToMatch(index) {
            const targetElement = largeSearchMatches[index].element;
            const allMarks = document.querySelectorAll('mark.current-match');
            allMarks.forEach(m => m.classList.remove('current-match'));
            
            const firstMarkInElement = targetElement.querySelector('mark');
            if (firstMarkInElement) {
                firstMarkInElement.classList.add('current-match');
            }
            
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function closeHistoryModal() {
            document.getElementById('history-contentModal').style.display = 'none';
        }
        function deleteHistoryFromModal() {
            if (appState.currentModalHistory) {
                deleteHistory(appState.currentModalHistory.id);
            }
        }
        async function deleteHistory(hid) {
            if (confirm(`Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a lá»‹ch sá»­ nÃ y khÃ´ng?`)) {
                let history = await getFromStorage('quizHistory') || [];
                history = history.filter(entry => entry.id != hid);
                await saveToStorage('quizHistory', history);
                closeHistoryModal();
                renderHistoryList();
                document.getElementById('history-questionBox').innerHTML = '';
                document.getElementById('history-questionBox').classList.add("hidden");
                alert('ÄÃ£ xÃ³a lá»‹ch sá»­!');
            }
        }
        
        let isSyncing = false;
        function showSyncStatus(message, type = 'syncing', duration = 3000) {
            const statusDiv = document.getElementById('sync-status');
            if (!statusDiv) return;
            statusDiv.textContent = message;
            statusDiv.className = type;
            statusDiv.style.display = 'block';

            if (type !== 'syncing') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, duration);
            }
        }

        async function sendSingleResultToFirebase(entry) {
            const { ref, get, set, serverTimestamp, db } = window.firebaseSDK;
            try {
                const { playerID, user, score, total, durationInMs, quizTopic } = entry;
                if (!playerID) {
                    console.error("Bá» qua Ä‘á»“ng bá»™: KhÃ´ng tÃ¬m tháº¥y PlayerID trong entry.");
                    return true;
                }
                const timeInSeconds = Math.round(durationInMs / 1000);

                const accuracy = (total > 0) ? (score / total) : 0;
                const newRankingScore = (accuracy >= 0.6) ? (score * 1000) - timeInSeconds : (score * 1000);
                const newOfficialScore = (total > 0) ? parseFloat(((score / total) * 10).toFixed(2)) : 0;

                const playerRef = ref(db, 'leaderboard/' + playerID);
                const snapshot = await get(playerRef);
                const oldRankingScore = snapshot.exists() ? (snapshot.val().rankingScore || -1) : -1;

                if (newRankingScore > oldRankingScore) {
                    const dataToSave = {
                        playerID: playerID,
                        playerName: user,
                        rankingScore: newRankingScore,
                        officialScore: newOfficialScore,
                        timeInSeconds: timeInSeconds,
                        submissionTimestamp: serverTimestamp(),
                        quizName: quizTopic,
                        correctAnswers: score,
                        totalQuestions: total
                    };
                    await set(playerRef, dataToSave);
                    console.log(`Gá»­i thÃ nh cÃ´ng káº¿t quáº£ cá»§a ID ${entry.id} lÃªn Firebase.`);
                } else {
                    console.log(`Bá» qua káº¿t quáº£ cá»§a ID ${entry.id} vÃ¬ Ä‘iá»ƒm khÃ´ng cao hÆ¡n.`);
                }
                
                return true;
            } catch (error) {
                console.error(`Lá»—i khi Ä‘á»“ng bá»™ ID ${entry.id} lÃªn Firebase:`, error);
                return false;
            }
        }

        async function syncResultsWithFirebase() {
            if (isSyncing || !navigator.onLine) return;
            isSyncing = true;
            showSyncStatus('Äang Ä‘á»“ng bá»™ káº¿t quáº£ vá»›i báº£ng xáº¿p háº¡ng...', 'syncing');

            let history = await getFromStorage('quizHistory') || [];
            const pendingEntries = history.filter(entry => !entry.isSyncedWithFirebase);

            if (pendingEntries.length === 0) {
                isSyncing = false;
                document.getElementById('sync-status').style.display = 'none';
                return;
            }

            let hasChanged = false;
            let successCount = 0;
            for (const entry of pendingEntries) {
                if (!entry.playerID) entry.playerID = localStorage.getItem('quizAppPlayerID');

                const success = await sendSingleResultToFirebase(entry);
                if (success) {
                    entry.isSyncedWithFirebase = true;
                    hasChanged = true;
                    successCount++;
                }
            }

            if (hasChanged) {
                await saveToStorage('quizHistory', history);
            }
            
            if (successCount > 0) {
                showSyncStatus(`Äá»“ng bá»™ thÃ nh cÃ´ng ${successCount}/${pendingEntries.length} káº¿t quáº£!`, 'success');
            } else if (pendingEntries.length > 0) {
                showSyncStatus('Äá»“ng bá»™ tháº¥t báº¡i, sáº½ thá»­ láº¡i sau.', 'error');
            }

            isSyncing = false;
        }

    </script>
</body>
</html>
